(function(){"use strict";const g="miroza_theme",w="miroza_subscribers",h="subscribers.txt",f="https://miroza.online";window.MIROZA=window.MIROZA||{},window.MIROZA.utils={qs:(i,e=document)=>e.querySelector(i),qsa:(i,e=document)=>Array.from(e.querySelectorAll(i)),shuffle(i){let e=i.length,s,l;for(;e;)l=Math.floor(Math.random()*e--),s=i[e],i[e]=i[l],i[l]=s;return i},safeHTML(i){if(window.DOMPurify)return DOMPurify.sanitize(i,{USE_PROFILES:{html:!0}});const e=document.createElement("div");return e.textContent=i,e.innerHTML},formatNumber(i){try{return Intl.NumberFormat("en-US",{notation:"compact",maximumFractionDigits:1}).format(i||0)}catch(e){return i||0}},debounce(i,e){let s;return function(...l){clearTimeout(s),s=setTimeout(()=>i.apply(this,l),e)}}},window.MIROZA.theme=(function(){function i(){const l=localStorage.getItem(g);l?document.documentElement.dataset.theme=l:window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches&&(document.documentElement.dataset.theme="dark"),s()}function e(){const o=(document.documentElement.dataset.theme||"light")==="dark"?"light":"dark";document.documentElement.dataset.theme=o,localStorage.setItem(g,o),s()}function s(){const l=window.MIROZA.utils.qs(".theme-toggle img");if(l){const o=document.documentElement.dataset.theme==="dark";l.src=o?"/assets/icons/sun.svg":"/assets/icons/moon.svg",l.alt=o?"Switch to light mode":"Switch to dark mode"}}return{init:i,toggle:e}})(),window.MIROZA.nav=(function(){let i=!1;function e(){const s=window.MIROZA.utils.qs(".menu-toggle"),l=window.MIROZA.utils.qs(".main-nav");!s||!l||(s.addEventListener("click",()=>{i=!i,l.classList.toggle("open",i),s.setAttribute("aria-expanded",i),s.innerHTML=i?'<img src="/assets/icons/close.svg" alt="Close" width="24" height="24" />':'<img src="/assets/icons/menu.svg" alt="Menu" width="24" height="24" />'}),l.addEventListener("click",o=>{o.target.tagName==="A"&&(i=!1,l.classList.remove("open"),s.setAttribute("aria-expanded","false"),s.innerHTML='<img src="/assets/icons/menu.svg" alt="Menu" width="24" height="24" />')}))}return{init:e}})(),window.MIROZA.subscription=(function(){function i(){const a=window.MIROZA.utils.qs("#newsletter-form");a&&a.addEventListener("submit",async n=>{n.preventDefault();const t=a.querySelector('input[type="email"]'),r=a.querySelector("button"),d=t.value.trim();if(!e(d)){s("Please enter a valid email address.","error");return}const c=window.MIROZA.utils.safeHTML(d);r.disabled=!0,r.textContent="Subscribing...";try{await l(c),s("Thank you for subscribing!","success"),t.value=""}catch(u){console.error("Subscription error:",u),s("Thank you! (Saved locally)","success")}finally{r.disabled=!1,r.textContent="Subscribe"}})}function e(a){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a)}function s(a,n){let t=window.MIROZA.utils.qs(".subscription-feedback");t||(t=document.createElement("p"),t.className="subscription-feedback",t.style.marginTop="0.5rem",t.style.fontSize="0.9rem",window.MIROZA.utils.qs("#newsletter-form").appendChild(t)),t.textContent=a,t.style.color=n==="error"?"#ef4444":"#10b981",setTimeout(()=>{t.textContent=""},5e3)}async function l(a){const n=JSON.parse(localStorage.getItem(w)||"[]");return n.includes(a)||(n.push(a),localStorage.setItem(w,JSON.stringify(n))),Promise.resolve()}async function o(){const a=JSON.parse(localStorage.getItem(w)||"[]");if(a.length===0){console.log("No subscribers to export.");return}const n=a.join(`
`);try{if(window.showSaveFilePicker){const r=await(await window.showSaveFilePicker({suggestedName:h,types:[{description:"Text File",accept:{"text/plain":[".txt"]}}]})).createWritable();await r.write(n),await r.close(),console.log("Subscribers exported successfully.")}else{const t=new Blob([n],{type:"text/plain"}),r=URL.createObjectURL(t),d=document.createElement("a");d.href=r,d.download=h,d.click(),URL.revokeObjectURL(r)}}catch(t){console.error("Export failed:",t)}}return window.MIROZA.exportSubscribers=o,{init:i}})(),window.MIROZA.store=(function(){let i=[],e=null;async function s(){try{const[n,t,r]=await Promise.all([fetch("/data/posts.json").then(m=>m.json()).catch(()=>[]),fetch("/data/news.json").then(m=>m.json()).catch(()=>[]),fetch("/data/blogs.json").then(m=>m.json()).catch(()=>[])]),d=n.map(m=>({...m,type:"article"})),c=t.map(m=>({...m,type:"news",category:"News"})),u=r.map(m=>({...m,type:"blog",category:"Blog"}));return i=[...d,...c,...u],i}catch(n){return console.error("Data load failed",n),[]}}function l(){return e=s(),e}function o(n){return n?i.filter(t=>t.type===n||n==="article"&&!t.type):i}function a(){return i}return{init:l,get:o,getAll:a,ready:()=>e}})(),window.MIROZA.builder=(function(){function i(e){const s=document.createElement("article");s.className="card fade-in",s.dataset.id=e.id||e.slug,s.dataset.label=e.category||"Story";const l=document.createElement("div");l.style.overflow="hidden";const o=document.createElement("img");o.loading="lazy";const a=e.image&&(e.image.src||e.image)||"/assets/images/hero-insight-800.svg";o.src=a,o.onerror=function(){this.src!=="/assets/images/hero-insight-800.svg"&&(this.src="/assets/images/hero-insight-800.svg")},o.alt=e.title,o.width=400,o.height=225,l.appendChild(o),s.appendChild(l);const n=document.createElement("div");n.className="card-content";const t=document.createElement("h3");t.className="card-title",t.innerHTML=window.MIROZA.utils.safeHTML(e.title);const r=document.createElement("p");r.className="card-meta";const d=e.date?new Date(e.date).toLocaleDateString():"";r.textContent=`${e.category||"Update"} \u2022 ${d}`;const c=document.createElement("p");c.className="card-excerpt",c.innerHTML=window.MIROZA.utils.safeHTML(e.excerpt||"");const u=document.createElement("a");u.className="read-more";let m=e.link;return m||(e.contentFile?m=e.contentFile:e.slug?m=`/${e.type==="blog"?"blogs":e.type==="news"?"news":"articles"}/${e.slug}.html`:m="#"),u.href=m,u.textContent="Read Article",n.appendChild(t),n.appendChild(r),n.appendChild(c),n.appendChild(u),s.appendChild(n),s}return{build:i}})(),window.MIROZA.home=(function(){async function i(){if(!document.body.dataset.page==="home"&&!window.MIROZA.utils.qs('[data-page="home"]'))return;await window.MIROZA.store.ready();const o=window.MIROZA.store.getAll(),a=o.filter(c=>c.type==="news").sort((c,u)=>new Date(u.date)-new Date(c.date));e("#news-cards",a,4);const n=o.filter(c=>c.type==="article").sort((c,u)=>new Date(u.date)-new Date(c.date));e("#articles-cards",n,4);const t=o.filter(c=>c.type==="blog").sort((c,u)=>new Date(u.date)-new Date(c.date));e("#blog-cards",t,4);const r=window.MIROZA.utils.shuffle([...o]);e("#latest-cards",r,8,!0),n.length>0&&l(n.slice(0,5));const d=[...o].sort((c,u)=>(u.views||0)-(c.views||0)).slice(0,5);s(d)}function e(o,a,n,t=!1){const r=window.MIROZA.utils.qs(o);r&&(t||(r.innerHTML=""),a.slice(0,n).forEach(d=>{const c=window.MIROZA.builder.build(d);r.appendChild(c)}))}function s(o){const a=window.MIROZA.utils.qs("#trending-list");a&&(a.innerHTML="",o.forEach(n=>{const t=document.createElement("li"),r=document.createElement("a");r.href=n.link||`/articles/${n.slug}.html`,r.textContent=n.title;const d=document.createElement("span");d.className="card-meta",d.textContent=`${window.MIROZA.utils.formatNumber(n.views)} views`,t.appendChild(r),t.appendChild(d),a.appendChild(t)}))}function l(o){const a=window.MIROZA.utils.qs(".hero");if(!a||!o.length)return;let n=0;const t={tag:a.querySelector("#hero-tag"),title:a.querySelector("#hero-heading"),excerpt:a.querySelector("#hero-excerpt"),img:a.querySelector("#hero-image"),link:a.querySelector("#hero-link")};function r(c){if(c){if(t.tag&&(t.tag.textContent=c.category||"Featured"),t.title&&(t.title.innerHTML=window.MIROZA.utils.safeHTML(c.title)),t.excerpt&&(t.excerpt.innerHTML=window.MIROZA.utils.safeHTML(c.excerpt)),t.img){const u=c.image&&(c.image.src||c.image)||"/assets/images/hero-insight-800.svg";t.img.src=u,t.img.onerror=function(){this.src.indexOf("/assets/images/hero-insight-800.svg")===-1&&(this.src="/assets/images/hero-insight-800.svg")},t.img.alt=c.title}t.link&&(t.link.href=c.link||`/articles/${c.slug}.html`)}}r(o[0]),setInterval(()=>{n=(n+1)%o.length,r(o[n])},8e3);const d=a.querySelector(".hero-advance");d&&d.addEventListener("click",()=>{n=(n+1)%o.length,r(o[n])})}return{init:i}})(),window.MIROZA.search=(function(){function i(){const e=window.MIROZA.utils.qs("#search"),s=window.MIROZA.utils.qs("#search-suggestions");!e||!s||(e.addEventListener("input",window.MIROZA.utils.debounce(l=>{const o=l.target.value.toLowerCase();if(o.length<2){s.hidden=!0;return}const n=window.MIROZA.store.getAll().filter(t=>t.title.toLowerCase().includes(o)).slice(0,5);s.innerHTML="",n.length?(s.hidden=!1,n.forEach(t=>{const r=document.createElement("button");r.className="search-suggestion",r.innerHTML=`<strong>${window.MIROZA.utils.safeHTML(t.title)}</strong><br><span>${t.category}</span>`,r.addEventListener("click",()=>{window.location.href=t.link||`/articles/${t.slug}.html`}),s.appendChild(r)})):s.hidden=!0},300)),document.addEventListener("click",l=>{!e.contains(l.target)&&!s.contains(l.target)&&(s.hidden=!0)}))}return{init:i}})(),document.addEventListener("DOMContentLoaded",()=>{window.MIROZA.theme.init(),window.MIROZA.nav.init(),window.MIROZA.subscription.init(),window.MIROZA.store.init().then(()=>{window.MIROZA.home.init(),window.MIROZA.search.init();const e=document.body.dataset.page;document.body.classList.add("js-ready")});const i=window.MIROZA.utils.qs(".theme-toggle");i&&i.addEventListener("click",window.MIROZA.theme.toggle)})})();

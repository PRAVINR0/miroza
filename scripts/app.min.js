(function(){"use strict";const w="miroza_theme",g="https://miroza.online";window.MIROZA=window.MIROZA||{},window.MIROZA.utils={qs:(t,e=document)=>e.querySelector(t),qsa:(t,e=document)=>Array.from(e.querySelectorAll(t)),shuffle(t){let e=t.length,i,c;for(;e;)c=Math.floor(Math.random()*e--),i=t[e],t[e]=t[c],t[c]=i;return t},safeHTML(t){if(window.DOMPurify)return DOMPurify.sanitize(t,{USE_PROFILES:{html:!0}});const e=document.createElement("div");return e.textContent=t,e.innerHTML},formatNumber(t){try{return Intl.NumberFormat("en-US",{notation:"compact",maximumFractionDigits:1}).format(t||0)}catch(e){return t||0}},debounce(t,e){let i;return function(...c){clearTimeout(i),i=setTimeout(()=>t.apply(this,c),e)}}},window.MIROZA.theme=(function(){function t(){const c=localStorage.getItem(w);c?document.documentElement.dataset.theme=c:window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches&&(document.documentElement.dataset.theme="dark"),i()}function e(){const n=(document.documentElement.dataset.theme||"light")==="dark"?"light":"dark";document.documentElement.dataset.theme=n,localStorage.setItem(w,n),i()}function i(){const c=window.MIROZA.utils.qs(".theme-toggle img");if(c){const n=document.documentElement.dataset.theme==="dark";c.src=n?"/assets/icons/sun.svg":"/assets/icons/moon.svg",c.alt=n?"Switch to light mode":"Switch to dark mode"}}return{init:t,toggle:e}})(),window.MIROZA.nav=(function(){let t=!1;function e(){const i=window.MIROZA.utils.qs(".menu-toggle"),c=window.MIROZA.utils.qs(".main-nav");!i||!c||(i.addEventListener("click",()=>{t=!t,c.classList.toggle("open",t),i.setAttribute("aria-expanded",t),i.innerHTML=t?'<img src="/assets/icons/close.svg" alt="Close" width="24" height="24" />':'<img src="/assets/icons/menu.svg" alt="Menu" width="24" height="24" />'}),c.addEventListener("click",n=>{n.target.tagName==="A"&&(t=!1,c.classList.remove("open"),i.setAttribute("aria-expanded","false"),i.innerHTML='<img src="/assets/icons/menu.svg" alt="Menu" width="24" height="24" />')}))}return{init:e}})(),window.MIROZA.store=(function(){let t=[],e=null;async function i(){try{const[a,o,r]=await Promise.all([fetch("/data/posts.json").then(d=>d.json()).catch(()=>[]),fetch("/data/news.json").then(d=>d.json()).catch(()=>[]),fetch("/data/blogs.json").then(d=>d.json()).catch(()=>[])]),u=a.map(d=>({...d,type:"article"})),s=o.map(d=>({...d,type:"news",category:"News"})),m=r.map(d=>({...d,type:"blog",category:"Blog"}));return t=[...u,...s,...m],t}catch(a){return console.error("Data load failed",a),[]}}function c(){return e=i(),e}function n(a){return a?t.filter(o=>o.type===a||a==="article"&&!o.type):t}function l(){return t}return{init:c,get:n,getAll:l,ready:()=>e}})(),window.MIROZA.builder=(function(){function t(e){const i=document.createElement("article");i.className="card fade-in",i.dataset.id=e.id||e.slug,i.dataset.label=e.category||"Story";const c=document.createElement("div");c.style.overflow="hidden";const n=document.createElement("img");n.loading="lazy";const l=e.image&&(e.image.src||e.image)||"/assets/images/hero-insight-800.svg";n.src=l,n.alt=e.title,n.width=400,n.height=225,c.appendChild(n),i.appendChild(c);const a=document.createElement("div");a.className="card-content";const o=document.createElement("h3");o.className="card-title",o.innerHTML=window.MIROZA.utils.safeHTML(e.title);const r=document.createElement("p");r.className="card-meta";const u=e.date?new Date(e.date).toLocaleDateString():"";r.textContent=`${e.category||"Update"} \u2022 ${u}`;const s=document.createElement("p");s.className="card-excerpt",s.innerHTML=window.MIROZA.utils.safeHTML(e.excerpt||"");const m=document.createElement("a");m.className="read-more";let d=e.link;return d||(e.contentFile?d=e.contentFile:e.slug?d=`/${e.type==="blog"?"blogs":e.type==="news"?"news":"articles"}/${e.slug}.html`:d="#"),m.href=d,m.textContent="Read Article",a.appendChild(o),a.appendChild(r),a.appendChild(s),a.appendChild(m),i.appendChild(a),i}return{build:t}})(),window.MIROZA.home=(function(){async function t(){if(!document.body.dataset.page==="home"&&!window.MIROZA.utils.qs('[data-page="home"]'))return;await window.MIROZA.store.ready();const n=window.MIROZA.store.getAll(),l=n.filter(s=>s.type==="news").sort((s,m)=>new Date(m.date)-new Date(s.date));e("#news-cards",l,4);const a=n.filter(s=>s.type==="article").sort((s,m)=>new Date(m.date)-new Date(s.date));e("#articles-cards",a,4);const o=n.filter(s=>s.type==="blog").sort((s,m)=>new Date(m.date)-new Date(s.date));e("#blog-cards",o,4);const r=window.MIROZA.utils.shuffle([...n]);e("#latest-cards",r,8,!0),a.length>0&&c(a.slice(0,5));const u=[...n].sort((s,m)=>(m.views||0)-(s.views||0)).slice(0,5);i(u)}function e(n,l,a,o=!1){const r=window.MIROZA.utils.qs(n);r&&(o||(r.innerHTML=""),l.slice(0,a).forEach(u=>{const s=window.MIROZA.builder.build(u);r.appendChild(s)}))}function i(n){const l=window.MIROZA.utils.qs("#trending-list");l&&(l.innerHTML="",n.forEach(a=>{const o=document.createElement("li"),r=document.createElement("a");r.href=a.link||`/articles/${a.slug}.html`,r.textContent=a.title;const u=document.createElement("span");u.className="card-meta",u.textContent=`${window.MIROZA.utils.formatNumber(a.views)} views`,o.appendChild(r),o.appendChild(u),l.appendChild(o)}))}function c(n){const l=window.MIROZA.utils.qs(".hero");if(!l||!n.length)return;let a=0;const o={tag:l.querySelector("#hero-tag"),title:l.querySelector("#hero-heading"),excerpt:l.querySelector("#hero-excerpt"),img:l.querySelector("#hero-image"),link:l.querySelector("#hero-link")};function r(s){s&&(o.tag&&(o.tag.textContent=s.category||"Featured"),o.title&&(o.title.innerHTML=window.MIROZA.utils.safeHTML(s.title)),o.excerpt&&(o.excerpt.innerHTML=window.MIROZA.utils.safeHTML(s.excerpt)),o.img&&(o.img.src=s.image&&(s.image.src||s.image)||"/assets/images/hero-insight-800.svg",o.img.alt=s.title),o.link&&(o.link.href=s.link||`/articles/${s.slug}.html`))}r(n[0]),setInterval(()=>{a=(a+1)%n.length,r(n[a])},8e3);const u=l.querySelector(".hero-advance");u&&u.addEventListener("click",()=>{a=(a+1)%n.length,r(n[a])})}return{init:t}})(),window.MIROZA.search=(function(){function t(){const e=window.MIROZA.utils.qs("#search"),i=window.MIROZA.utils.qs("#search-suggestions");!e||!i||(e.addEventListener("input",window.MIROZA.utils.debounce(c=>{const n=c.target.value.toLowerCase();if(n.length<2){i.hidden=!0;return}const a=window.MIROZA.store.getAll().filter(o=>o.title.toLowerCase().includes(n)).slice(0,5);i.innerHTML="",a.length?(i.hidden=!1,a.forEach(o=>{const r=document.createElement("button");r.className="search-suggestion",r.innerHTML=`<strong>${window.MIROZA.utils.safeHTML(o.title)}</strong><br><span>${o.category}</span>`,r.addEventListener("click",()=>{window.location.href=o.link||`/articles/${o.slug}.html`}),i.appendChild(r)})):i.hidden=!0},300)),document.addEventListener("click",c=>{!e.contains(c.target)&&!i.contains(c.target)&&(i.hidden=!0)}))}return{init:t}})(),document.addEventListener("DOMContentLoaded",()=>{window.MIROZA.theme.init(),window.MIROZA.nav.init(),window.MIROZA.store.init().then(()=>{window.MIROZA.home.init(),window.MIROZA.search.init();const e=document.body.dataset.page;document.body.classList.add("js-ready")});const t=window.MIROZA.utils.qs(".theme-toggle");t&&t.addEventListener("click",window.MIROZA.theme.toggle)})})();

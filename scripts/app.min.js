(function(){"use strict";const g="miroza_theme",m="miroza_subscribers",f="subscribers.txt",M="https://miroza.online";window.MIROZA=window.MIROZA||{},window.MIROZA.utils={qs:(n,t=document)=>t.querySelector(n),qsa:(n,t=document)=>Array.from(t.querySelectorAll(n)),shuffle(n){let t=n.length,o,e;for(;t;)e=Math.floor(Math.random()*t--),o=n[t],n[t]=n[e],n[e]=o;return n},safeHTML(n){if(window.DOMPurify)return DOMPurify.sanitize(n,{USE_PROFILES:{html:!0}});const t=document.createElement("div");return t.textContent=n,t.innerHTML},formatNumber(n){try{return Intl.NumberFormat("en-US",{notation:"compact",maximumFractionDigits:1}).format(n||0)}catch(t){return n||0}},debounce(n,t){let o;return function(...e){clearTimeout(o),o=setTimeout(()=>n.apply(this,e),t)}}},window.MIROZA.store=(function(){let n=[],t=null;function o(){return t||(t=Promise.all([fetch("/data/posts.json").then(e=>e.ok?e.json():[])]).then(([e])=>(n=e,!0)).catch(e=>(console.error("Failed to load data:",e),!1)),t)}return{init:o,ready:()=>t,getAll:()=>n,getByCategory:e=>n.filter(i=>i.category===e)}})(),window.MIROZA.builder=(function(){function n(t){const o=document.createElement("article");o.className="card";const e=t.image&&t.image.src?t.image.src:"/assets/images/hero-insight-800.svg",i=t.image&&t.image.alt?t.image.alt:t.title,s=`
        <a href="${t.link}" class="card-link" aria-label="Read ${window.MIROZA.utils.safeHTML(t.title)}">
          <img src="${e}" alt="${window.MIROZA.utils.safeHTML(i)}" loading="lazy" width="400" height="225" />
        </a>
        <div class="card-content">
          <div class="card-meta">
            <span class="category">${window.MIROZA.utils.safeHTML(t.category||"Story")}</span> \u2022
            <span class="date">${new Date(t.date).toLocaleDateString()}</span>
          </div>
          <h3 class="card-title">
            <a href="${t.link}">${window.MIROZA.utils.safeHTML(t.title)}</a>
          </h3>
          <p class="card-excerpt">${window.MIROZA.utils.safeHTML(t.excerpt||"")}</p>
          <a href="${t.link}" class="read-more" aria-hidden="true">Read Article</a>
        </div>
      `;return o.innerHTML=s,o}return{build:n}})(),window.MIROZA.theme=(function(){function n(){const e=localStorage.getItem(g);e?document.documentElement.dataset.theme=e:window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches&&(document.documentElement.dataset.theme="dark"),o()}function t(){const i=(document.documentElement.dataset.theme||"light")==="dark"?"light":"dark";document.documentElement.dataset.theme=i,localStorage.setItem(g,i),o()}function o(){const e=window.MIROZA.utils.qs(".theme-toggle img");if(e){const i=document.documentElement.dataset.theme==="dark";e.src=i?"/assets/icons/sun.svg":"/assets/icons/moon.svg",e.alt=i?"Switch to light mode":"Switch to dark mode"}}return{init:n,toggle:t}})(),window.MIROZA.nav=(function(){let n=!1;function t(){const o=window.MIROZA.utils.qs(".menu-toggle"),e=window.MIROZA.utils.qs(".main-nav");!o||!e||(o.addEventListener("click",()=>{n=!n,e.classList.toggle("open",n),o.setAttribute("aria-expanded",n),o.innerHTML=n?'<img src="/assets/icons/close.svg" alt="Close" width="24" height="24" />':'<img src="/assets/icons/menu.svg" alt="Menu" width="24" height="24" />'}),e.addEventListener("click",i=>{i.target.tagName==="A"&&(n=!1,e.classList.remove("open"),o.setAttribute("aria-expanded","false"),o.innerHTML='<img src="/assets/icons/menu.svg" alt="Menu" width="24" height="24" />')}))}return{init:t}})(),window.MIROZA.home=(function(){async function n(){if(!window.MIROZA.utils.qs("#hero-heading"))return;await window.MIROZA.store.ready();const i=window.MIROZA.store.getAll(),s=i.filter(u=>["World","News","Politics","Weather"].includes(u.category)),a=i.filter(u=>["Technology","Science","Health","Finance","Automobiles","Space"].includes(u.category)),r=i.filter(u=>["Lifestyle","Travel","Career","Education","Blog","Business"].includes(u.category)),l=u=>u.length?u:i;t("#news-cards",l(s),4),t("#articles-cards",l(a),4),t("#blog-cards",l(r),4);const c=window.MIROZA.utils.shuffle([...i]);t("#latest-cards",c,8,!0);const d=[...a,...s].slice(0,5);d.length>0&&e(d);const w=[...i].sort((u,h)=>(h.views||0)-(u.views||0)).slice(0,5);o(w)}function t(i,s,a,r=!1){const l=window.MIROZA.utils.qs(i);l&&(r||(l.innerHTML=""),s.slice(0,a).forEach(c=>{const d=window.MIROZA.builder.build(c);l.appendChild(d)}))}function o(i){const s=window.MIROZA.utils.qs("#trending-list");s&&(s.innerHTML="",i.forEach(a=>{const r=document.createElement("li"),l=document.createElement("a");l.href=a.link||`/articles/${a.slug}.html`,l.textContent=a.title;const c=document.createElement("span");c.className="card-meta",c.textContent=`${window.MIROZA.utils.formatNumber(a.views)} views`,r.appendChild(l),r.appendChild(c),s.appendChild(r)}))}function e(i){const s=window.MIROZA.utils.qs(".hero");if(!s||!i.length)return;let a=0;const r={tag:s.querySelector("#hero-tag"),title:s.querySelector("#hero-heading"),excerpt:s.querySelector("#hero-excerpt"),img:s.querySelector("#hero-image"),link:s.querySelector("#hero-link")};function l(d){if(d){if(r.tag&&(r.tag.textContent=d.category||"Featured"),r.title&&(r.title.innerHTML=window.MIROZA.utils.safeHTML(d.title)),r.excerpt&&(r.excerpt.innerHTML=window.MIROZA.utils.safeHTML(d.excerpt)),r.img){const w=d.image&&d.image.src?d.image.src:"/assets/images/hero-insight-800.svg";r.img.src=w,r.img.alt=d.title}r.link&&(r.link.href=d.link||`/articles/${d.slug}.html`)}}l(i[0]),setInterval(()=>{a=(a+1)%i.length,l(i[a])},8e3);const c=s.querySelector(".hero-advance");c&&c.addEventListener("click",()=>{a=(a+1)%i.length,l(i[a])})}return{init:n}})(),window.MIROZA.search=(function(){function n(){const t=window.MIROZA.utils.qs("#search"),o=window.MIROZA.utils.qs("#search-suggestions");!t||!o||(t.addEventListener("input",window.MIROZA.utils.debounce(e=>{const i=e.target.value.toLowerCase();if(i.length<2){o.hidden=!0;return}const a=window.MIROZA.store.getAll().filter(r=>r.title.toLowerCase().includes(i)).slice(0,5);o.innerHTML="",a.length?(o.hidden=!1,a.forEach(r=>{const l=document.createElement("button");l.className="search-suggestion",l.innerHTML=`<strong>${window.MIROZA.utils.safeHTML(r.title)}</strong><br><span>${r.category}</span>`,l.addEventListener("click",()=>{window.location.href=r.link||`/articles/${r.slug}.html`}),o.appendChild(l)})):o.hidden=!0},300)),document.addEventListener("click",e=>{!t.contains(e.target)&&!o.contains(e.target)&&(o.hidden=!0)}))}return{init:n}})(),window.MIROZA.subscription=(function(){function n(){const e=window.MIROZA.utils.qs("#newsletter-form");if(!e)return;if(!e.querySelector('input[type="email"]')){const s=document.createElement("input");s.type="email",s.placeholder="Your email address",s.required=!0,s.setAttribute("aria-label","Email address"),e.insertBefore(s,e.querySelector("button"))}e.addEventListener("submit",s=>{s.preventDefault();const a=e.querySelector('input[type="email"]'),r=a.value.trim();if(!r)return;t(r);const l=e.querySelector("button").textContent;e.querySelector("button").textContent="Subscribed!",e.querySelector("button").disabled=!0,a.value="",setTimeout(()=>{e.querySelector("button").textContent=l,e.querySelector("button").disabled=!1},3e3)});const i=window.MIROZA.utils.qs(".newsletter h3");i&&(i.addEventListener("dblclick",o),i.title="Admin: Double click to download subscriber list")}function t(e){let i=[];try{const a=localStorage.getItem(m);a&&(i=JSON.parse(a))}catch(a){}const s={email:e,date:new Date().toISOString(),source:"newsletter-form"};i.push(s),localStorage.setItem(m,JSON.stringify(i)),console.log("Subscriber saved locally:",s)}function o(){let e=[];try{const c=localStorage.getItem(m);c&&(e=JSON.parse(c))}catch(c){}if(!e.length){alert("No subscribers yet.");return}const i=`Email,Date,Source
`,s=e.map(c=>`${c.email},${c.date},${c.source}`).join(`
`),a=new Blob([i+s],{type:"text/csv"}),r=URL.createObjectURL(a),l=document.createElement("a");l.href=r,l.download="subscribers.csv",document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(r)}return{init:n}})(),document.addEventListener("DOMContentLoaded",()=>{window.MIROZA.theme.init(),window.MIROZA.nav.init(),window.MIROZA.subscription.init(),window.MIROZA.store.init().then(()=>{window.MIROZA.home.init(),window.MIROZA.search.init(),document.body.classList.add("js-ready")});const n=window.MIROZA.utils.qs(".theme-toggle");n&&n.addEventListener("click",window.MIROZA.theme.toggle)}),window.MIROZA.loadPosts=async()=>(await window.MIROZA.store.init(),window.MIROZA.store.getAll()),window.MIROZA.buildCard=window.MIROZA.builder.build})();

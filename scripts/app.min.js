(function(){"use strict";const A="theme",M="miroza_subscribers",O="https://miroza.online";window.MIROZA=window.MIROZA||{},window.MIROZA.utils={qs:(i,t=document)=>t.querySelector(i),qsa:(i,t=document)=>Array.from(t.querySelectorAll(i)),shuffle(i){let t=i.length,o,e;for(;t;)e=Math.floor(Math.random()*t--),o=i[t],i[t]=i[e],i[e]=o;return i},safeHTML(i){if(window.DOMPurify)return DOMPurify.sanitize(i,{USE_PROFILES:{html:!0}});const t=document.createElement("div");return t.textContent=i,t.innerHTML},formatNumber(i){try{return Intl.NumberFormat("en-US",{notation:"compact",maximumFractionDigits:1}).format(i||0)}catch(t){return i||0}},debounce(i,t){let o;return function(...e){clearTimeout(o),o=setTimeout(()=>i.apply(this,e),t)}}},window.MIROZA.store=function(){let i=[],t=null;function o(){return t||(t=Promise.all([fetch("/data/posts.json").then(e=>e.ok?e.json():[])]).then(([e])=>(i=e,!0)).catch(e=>(console.error("Failed to load data:",e),!1)),t)}return{init:o,ready:()=>t,getAll:()=>i,getByCategory:e=>i.filter(r=>r.category===e)}}(),window.MIROZA.builder=function(){function i(t){const o=document.createElement("article");o.className="card post-card";const e=t.image,r=e?typeof e=="string"?e:e.src||"/assets/images/hero-insight-800.svg":"/assets/images/hero-insight-800.svg",l=e&&typeof e=="object"&&e.alt?e.alt:t.title||"";let c=t.link||t.url||"";c||(t.slug?c=t.category&&t.category.toLowerCase()==="blog"?`/blogs/${t.slug}.html`:`/articles/${t.slug}.html`:c="/");let n="",s="";e&&typeof e=="object"&&(e.srcset&&(n=`srcset="${e.srcset}"`),e.sizes&&(s=`sizes="${e.sizes}"`));const a=`
        <a href="${c}" class="card-link" aria-label="Read ${window.MIROZA.utils.safeHTML(t.title||"")}">
          <div class="card-image-wrap">
             <img src="${r}" ${n} ${s} alt="${window.MIROZA.utils.safeHTML(l)}" loading="lazy" decoding="async" width="400" height="225" onerror="this.onerror=null;this.src='/assets/images/hero-insight-800.svg'" />
          </div>
          <div class="card-content card-body">
            <div class="card-meta">
              <span class="category">${window.MIROZA.utils.safeHTML(t.category||"Story")}</span> \u2022
              <span class="date">${t.date?new Date(t.date).toLocaleDateString():""}</span>
            </div>
            <h3 class="card-title">
              ${window.MIROZA.utils.safeHTML(t.title||"")}
            </h3>
            <p class="card-excerpt">${window.MIROZA.utils.safeHTML(t.excerpt||"")}</p>
            <span class="read-more" aria-hidden="true">Read Article</span>
          </div>
        </a>
      `;return o.innerHTML=a,o}return{build:i}}(),window.MIROZA.theme=function(){function i(){const e=localStorage.getItem(A);e?document.documentElement.dataset.theme=e:window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches&&(document.documentElement.dataset.theme="dark"),o()}function t(){const r=(document.documentElement.dataset.theme||"light")==="dark"?"light":"dark";document.documentElement.dataset.theme=r,localStorage.setItem(A,r),o()}function o(){const e=window.MIROZA.utils.qs(".theme-toggle img");if(e){const r=document.documentElement.dataset.theme==="dark";e.src=r?"/assets/icons/sun.svg":"/assets/icons/moon.svg",e.alt=r?"Switch to light mode":"Switch to dark mode"}}return{init:i,toggle:t}}(),window.MIROZA.nav=function(){let i=!1;function t(){const o=window.MIROZA.utils.qs(".menu-toggle"),e=window.MIROZA.utils.qs(".main-nav");!o||!e||(o.addEventListener("click",()=>{i=!i,e.classList.toggle("open",i),o.setAttribute("aria-expanded",i),o.innerHTML=i?'<img src="/assets/icons/close.svg" alt="Close" width="24" height="24" />':'<img src="/assets/icons/menu.svg" alt="Menu" width="24" height="24" />'}),e.addEventListener("click",r=>{r.target.tagName==="A"&&(i=!1,e.classList.remove("open"),o.setAttribute("aria-expanded","false"),o.innerHTML='<img src="/assets/icons/menu.svg" alt="Menu" width="24" height="24" />')}))}return{init:t}}(),window.MIROZA.ui=function(){let i,t,o=!1;function e(){const n=window.scrollY||document.documentElement.scrollTop||0;i&&i.classList.toggle("is-stuck",n>24),t&&t.classList.toggle("visible",n>480)}function r(){t&&t.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})})}function l(){const n=window.MIROZA.utils.qsa(".single-article img, main img[data-enhance-responsive]");n.length&&n.forEach(s=>{s&&(s.getAttribute("loading")||(s.loading="lazy"),s.decoding="async")})}function c(){i=window.MIROZA.utils.qs(".site-header"),t=window.MIROZA.utils.qs(".back-to-top"),r(),window.addEventListener("scroll",()=>{o||(o=!0,window.requestAnimationFrame(()=>{e(),o=!1}))},{passive:!0}),e(),l()}return{init:c}}(),window.MIROZA.search=function(){function i(){const t=window.MIROZA.utils.qs("#search"),o=window.MIROZA.utils.qs("#search-suggestions");!t||!o||!window.MIROZA.store||(t.addEventListener("input",window.MIROZA.utils.debounce(e=>{const r=e.target.value.toLowerCase();if(r.length<2){o.hidden=!0;return}const c=window.MIROZA.store.getAll().filter(n=>(n.title||"").toLowerCase().includes(r)).slice(0,5);o.innerHTML="",c.length?(o.hidden=!1,c.forEach(n=>{const s=document.createElement("button");s.className="search-suggestion",s.innerHTML=`<strong>${window.MIROZA.utils.safeHTML(n.title)}</strong><br><span>${window.MIROZA.utils.safeHTML(n.category||"")}</span>`,s.addEventListener("click",()=>{window.location.href=n.link||`/articles/${n.slug}.html`}),o.appendChild(s)})):o.hidden=!0},300)),document.addEventListener("click",e=>{!t.contains(e.target)&&!o.contains(e.target)&&(o.hidden=!0)}))}return{init:i}}(),window.MIROZA.subscription=function(){function i(){const e=window.MIROZA.utils.qs("#newsletter-form");if(!e)return;if(!e.querySelector('input[type="email"]')){const l=document.createElement("input");l.type="email",l.placeholder="Your email address",l.required=!0,l.setAttribute("aria-label","Email address"),e.insertBefore(l,e.querySelector("button"))}e.addEventListener("submit",l=>{l.preventDefault();const c=e.querySelector('input[type="email"]'),n=c.value.trim();if(!n)return;t(n);const s=e.querySelector("button").textContent;e.querySelector("button").textContent="Subscribed!",e.querySelector("button").disabled=!0,c.value="",setTimeout(()=>{e.querySelector("button").textContent=s,e.querySelector("button").disabled=!1},3e3)});const r=window.MIROZA.utils.qs(".newsletter h3");r&&(r.addEventListener("dblclick",o),r.title="Admin: Double click to download subscriber list")}function t(e){let r=[];try{const c=localStorage.getItem(M);c&&(r=JSON.parse(c))}catch(c){}const l={email:e,date:new Date().toISOString(),source:"newsletter-form"};r.push(l),localStorage.setItem(M,JSON.stringify(r)),console.log("Subscriber saved locally:",l)}function o(){let e=[];try{const a=localStorage.getItem(M);a&&(e=JSON.parse(a))}catch(a){}if(!e.length){alert("No subscribers yet.");return}const r=`Email,Date,Source
`,l=e.map(a=>`${a.email},${a.date},${a.source}`).join(`
`),c=new Blob([r+l],{type:"text/csv"}),n=URL.createObjectURL(c),s=document.createElement("a");s.href=n,s.download="subscribers.csv",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(n)}return{init:i}}(),window.MIROZA.home=function(){function i(o,e){const r=window.MIROZA.utils.qs(`#${o}`);r&&(r.innerHTML="",e.forEach(l=>{r.appendChild(window.MIROZA.builder.build(l))}))}function t(){if(!window.MIROZA.store)return;const o=window.MIROZA.store.getAll();if(!o||!o.length)return;let e=[];try{fetch("/data/news.json").then(n=>n.ok?n.json():[]).then(n=>{if(n&&n.length){const a=n.slice().sort((d,w)=>(w.date||"").localeCompare(d.date||"")).slice(0,4).map(d=>({title:d.title,slug:d.slug,date:d.date,category:d.category||"News",excerpt:d.excerpt,link:d.contentFile||`/news/${d.slug}.html`,image:d.image?{src:d.image,alt:d.title}:null}));i("news-cards",a);return}const s=o.filter(a=>a.category==="News").slice(0,4);i("news-cards",s)}).catch(()=>{const n=o.filter(s=>s.category==="News").slice(0,4);i("news-cards",n)})}catch(n){const s=o.filter(a=>a.category==="News").slice(0,4);i("news-cards",s)}const r=o.filter(n=>n.category==="Blog").slice(0,4),l=o.filter(n=>n.category!=="News"&&n.category!=="Blog").slice(0,4);i("blog-cards",r),i("articles-cards",l);const c=window.MIROZA.utils.shuffle(o.slice(0)).slice(0,8);i("latest-cards",c)}return{init:t}}(),window.MIROZA.indiaNews=function(){function i(e){return{title:e.title,slug:e.slug,date:e.date,category:"India",excerpt:e.excerpt,link:e.contentFile||`/news/${e.slug}.html`,image:e.image?{src:e.image,alt:e.title}:null}}function t(){try{return new URLSearchParams(window.location.search).get("topic")}catch(e){return null}}function o(){const e=window.MIROZA.utils.qs("#india-news-list");e&&fetch("/data/news.json").then(r=>r.ok?r.json():[]).then(r=>{e.innerHTML="";let l=r.slice().sort((n,s)=>(s.date||"").localeCompare(n.date||""));const c=t();if(c&&(l=l.filter(n=>(n.category||"").toLowerCase()===c.toLowerCase()||(n.title||"").toLowerCase().includes(c.toLowerCase()))),l.length===0){e.innerHTML="<p>No news found for this topic.</p>";return}l.forEach(n=>{e.appendChild(window.MIROZA.builder.build(i(n)))})}).catch(()=>{e.innerHTML="<p>Unable to load latest India news right now.</p>"})}return{init:o}}(),window.MIROZA.listing=function(){function i(){try{const n=new URLSearchParams(window.location.search),s=parseInt(n.get("page"),10);return isNaN(s)||s<1?1:s}catch(n){return 1}}function t(){try{return new URLSearchParams(window.location.search).get("topic")}catch(n){return null}}function o(n){try{const s=new URL(window.location.href);s.searchParams.set("page",String(n)),window.history.replaceState({},"",s.toString())}catch(s){}}function e(n,s,a=12,d=null){const w=window.MIROZA.utils.qs(n);if(!w)return null;w.innerHTML="";const m=d||i()||1,u={items:s,pageSize:a,index:(m-1)*a};u.index>0&&u.items.slice(0,u.index).forEach(p=>w.appendChild(window.MIROZA.builder.build(p)));function f(){const h=u.items.slice(u.index,u.index+u.pageSize);return h.forEach(p=>w.appendChild(window.MIROZA.builder.build(p))),u.index+=h.length,u.index<u.items.length}u.index===0&&f();const g=Math.ceil(u.index/u.pageSize)||1;return o(g),{renderNext:f,state:u}}function r(n,s){const a=window.MIROZA.utils.qs(n);if(!a||!s||(a.innerHTML="",s.state.index>=s.state.items.length))return;const d=document.createElement("button");d.className="load-more",d.textContent="Load more",d.addEventListener("click",()=>{const w=s.renderNext(),m=Math.ceil(s.state.index/s.state.pageSize)||1;o(m),w||d.remove()}),a.appendChild(d)}function l(){const n="#articles-list",s="#articles-pagination";if(!window.MIROZA.store||!window.MIROZA.utils.qs(n))return;const a=window.MIROZA.store.getAll();if(!a||!a.length){window.MIROZA.utils.qs(n).innerHTML="<p>No articles found.</p>";return}const d=t();let w=a.filter(u=>u.category!=="Blog").slice().sort((u,f)=>(f.date||"").localeCompare(u.date||""));d&&(w=w.filter(u=>(u.category||"").toLowerCase()===d.toLowerCase()||(u.title||"").toLowerCase().includes(d.toLowerCase())));const m=e(n,w,12);r(s,m)}async function c(){const n="#posts-grid";let s="#blogs-pagination";if(window.MIROZA.utils.qs(n)){if(!window.MIROZA.utils.qs(s)){const a=document.createElement("nav");a.id="blogs-pagination",a.className="pagination",window.MIROZA.utils.qs(n).parentNode.appendChild(a)}try{const a=await fetch("/data/blogs.json");let d=[];a.ok?d=await a.json():(await window.MIROZA.store.init(),d=window.MIROZA.store.getAll().filter(g=>g.category==="Blog"));let w=d.slice().sort((g,h)=>(h.date||"").localeCompare(g.date||"")).map(g=>({title:g.title,slug:g.slug,date:g.date,category:"Blog",excerpt:g.excerpt,link:g.url||g.contentFile||`/blogs/${g.slug}.html`,image:g.image?{src:g.image,alt:g.title}:null}));const m=t();m&&(w=w.filter(g=>(g.title||"").toLowerCase().includes(m.toLowerCase())));const u=e(n,w,12);r(s,u);const f=document.getElementById("posts-skeleton");f&&(f.style.display="none")}catch(a){console.error("Failed to load blogs",a)}}}return{initArticles:l,initBlogs:c}}(),window.MIROZA.postMeta=function(){function i(){var u,f,g,h,p,b,y;const t=document.body.dataset.page||"";if(!/article|news-article|blog-article/.test(t)||document.querySelector('script[type="application/ld+json"]'))return;const o=((u=document.querySelector('meta[property="og:title"]'))==null?void 0:u.getAttribute("content"))||document.title,e=((f=document.querySelector('meta[name="description"]'))==null?void 0:f.getAttribute("content"))||((g=document.querySelector('meta[property="og:description"]'))==null?void 0:g.getAttribute("content"))||"",r=((h=document.querySelector('meta[property="og:image"]'))==null?void 0:h.getAttribute("content"))||((p=document.querySelector("img"))==null?void 0:p.src)||"",l=((b=document.querySelector('link[rel="canonical"]'))==null?void 0:b.href)||window.location.href,c=document.querySelector(".single-article time")||document.querySelector(".meta time"),n=c?c.getAttribute("datetime")||c.textContent:((y=document.querySelector('meta[property="article:published_time"]'))==null?void 0:y.getAttribute("content"))||"",s=document.querySelector(".author")||document.querySelector('meta[name="author"]'),a=s?s.textContent||s.getAttribute("content"):"",w={"@context":"https://schema.org","@type":t==="blog-article"||t==="blog"?"BlogPosting":"NewsArticle",headline:o,description:e,image:r,datePublished:n||void 0,author:a?{"@type":"Person",name:a}:void 0,publisher:{"@type":"Organization",name:"MIROZA",logo:{"@type":"ImageObject",url:location.origin+"/assets/icons/logo.svg"}},mainEntityOfPage:{"@type":"WebPage","@id":l}};Object.keys(w).forEach(I=>w[I]===void 0&&delete w[I]);const m=document.createElement("script");m.type="application/ld+json",m.text=JSON.stringify(w,null,2),document.head.appendChild(m)}return{init:i}}(),document.addEventListener("DOMContentLoaded",()=>{window.MIROZA.theme.init(),window.MIROZA.nav.init(),window.MIROZA.ui.init(),window.MIROZA.subscription.init();const i=window.MIROZA.utils.qs(".theme-toggle");i&&i.addEventListener("click",window.MIROZA.theme.toggle);const t=document.body.dataset.page||"home",o=t==="home",e=t==="india-news",r=t==="articles",l=t==="blog";window.MIROZA.store&&typeof window.MIROZA.store.init=="function"?window.MIROZA.store.init().then(()=>{o&&window.MIROZA.home&&window.MIROZA.home.init(),r&&window.MIROZA.listing&&window.MIROZA.listing.initArticles(),l&&window.MIROZA.listing&&window.MIROZA.listing.initBlogs(),window.MIROZA.search&&window.MIROZA.search.init(),e&&window.MIROZA.indiaNews&&window.MIROZA.indiaNews.init(),window.MIROZA.postMeta&&window.MIROZA.postMeta.init(),document.body.classList.add("js-ready")}).catch(()=>{e&&window.MIROZA.indiaNews&&window.MIROZA.indiaNews.init(),window.MIROZA.postMeta&&window.MIROZA.postMeta.init(),document.body.classList.add("js-ready")}):(e&&window.MIROZA.indiaNews&&window.MIROZA.indiaNews.init(),l&&window.MIROZA.listing&&window.MIROZA.listing.initBlogs(),window.MIROZA.postMeta&&window.MIROZA.postMeta.init(),document.body.classList.add("js-ready"));try{const c=(location.pathname||"").toLowerCase(),n=c.indexOf("/articles/")===0&&!/articles(\/|index\.html|articles\.html)$/.test(c),s=c.indexOf("/blogs/")===0&&!/blogs(\/|index\.html|blogs\.html)$/.test(c);if(n||s){const a=document.createElement("script");a.src="/scripts/article-nav.js",a.defer=!0,document.body.appendChild(a)}}catch(c){}}),window.MIROZA.loadPosts=async()=>(await window.MIROZA.store.init(),window.MIROZA.store.getAll()),window.MIROZA.buildCard=window.MIROZA.builder.build})();

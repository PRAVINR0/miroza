(function(){"use strict";const p="theme",M="miroza_subscribers",O="subscribers.txt",R="https://miroza.online";window.MIROZA=window.MIROZA||{},window.MIROZA.utils={qs:(o,n=document)=>n.querySelector(o),qsa:(o,n=document)=>Array.from(n.querySelectorAll(o)),shuffle(o){let n=o.length,t,e;for(;n;)e=Math.floor(Math.random()*n--),t=o[n],o[n]=o[e],o[e]=t;return o},safeHTML(o){if(window.DOMPurify)return DOMPurify.sanitize(o,{USE_PROFILES:{html:!0}});const n=document.createElement("div");return n.textContent=o,n.innerHTML},formatNumber(o){try{return Intl.NumberFormat("en-US",{notation:"compact",maximumFractionDigits:1}).format(o||0)}catch(n){return o||0}},debounce(o,n){let t;return function(...e){clearTimeout(t),t=setTimeout(()=>o.apply(this,e),n)}}},window.MIROZA.store=function(){let o=[],n=null;function t(){return n||(n=Promise.all([fetch("/data/posts.json").then(e=>e.ok?e.json():[])]).then(([e])=>(o=e,!0)).catch(e=>(console.error("Failed to load data:",e),!1)),n)}return{init:t,ready:()=>n,getAll:()=>o,getByCategory:e=>o.filter(r=>r.category===e)}}(),window.MIROZA.builder=function(){function o(n){const t=document.createElement("article");t.className="card";const e=n.image,r=e?typeof e=="string"?e:e.src||"/assets/images/hero-insight-800.svg":"/assets/images/hero-insight-800.svg",l=e&&typeof e=="object"&&e.alt?e.alt:n.title||"";let a=n.link||n.url||"";a||(n.slug?a=n.category&&n.category.toLowerCase()==="blog"?`/blogs/${n.slug}.html`:`/articles/${n.slug}.html`:a="/");let i="",s="";e&&typeof e=="object"&&(e.srcset&&(i=`srcset="${e.srcset}"`),e.sizes&&(s=`sizes="${e.sizes}"`));const d=`
        <a href="${a}" class="card-link" aria-label="Read ${window.MIROZA.utils.safeHTML(n.title||"")}">
          <img src="${r}" ${i} ${s} alt="${window.MIROZA.utils.safeHTML(l)}" loading="lazy" decoding="async" width="400" height="225" onerror="this.onerror=null;this.src='/assets/images/hero-insight-800.svg'" />
        </a>
        <div class="card-content">
          <div class="card-meta">
            <span class="category">${window.MIROZA.utils.safeHTML(n.category||"Story")}</span> \u2022
            <span class="date">${n.date?new Date(n.date).toLocaleDateString():""}</span>
          </div>
          <h3 class="card-title">
            <a href="${a}">${window.MIROZA.utils.safeHTML(n.title||"")}</a>
          </h3>
          <p class="card-excerpt">${window.MIROZA.utils.safeHTML(n.excerpt||"")}</p>
          <a href="${a}" class="read-more" aria-hidden="true">Read Article</a>
        </div>
      `;return t.innerHTML=d,t}return{build:o}}(),window.MIROZA.theme=function(){function o(){const e=localStorage.getItem(p);e?document.documentElement.dataset.theme=e:window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches&&(document.documentElement.dataset.theme="dark"),t()}function n(){const r=(document.documentElement.dataset.theme||"light")==="dark"?"light":"dark";document.documentElement.dataset.theme=r,localStorage.setItem(p,r),t()}function t(){const e=window.MIROZA.utils.qs(".theme-toggle img");if(e){const r=document.documentElement.dataset.theme==="dark";e.src=r?"/assets/icons/sun.svg":"/assets/icons/moon.svg",e.alt=r?"Switch to light mode":"Switch to dark mode"}}return{init:o,toggle:n}}(),window.MIROZA.nav=function(){let o=!1;function n(){const t=window.MIROZA.utils.qs(".menu-toggle"),e=window.MIROZA.utils.qs(".main-nav");!t||!e||(t.addEventListener("click",()=>{o=!o,e.classList.toggle("open",o),t.setAttribute("aria-expanded",o),t.innerHTML=o?'<img src="/assets/icons/close.svg" alt="Close" width="24" height="24" />':'<img src="/assets/icons/menu.svg" alt="Menu" width="24" height="24" />'}),e.addEventListener("click",r=>{r.target.tagName==="A"&&(o=!1,e.classList.remove("open"),t.setAttribute("aria-expanded","false"),t.innerHTML='<img src="/assets/icons/menu.svg" alt="Menu" width="24" height="24" />')}))}return{init:n}}(),window.MIROZA.ui=function(){let o,n,t=!1;function e(){const i=window.scrollY||document.documentElement.scrollTop||0;o&&o.classList.toggle("is-stuck",i>24),n&&n.classList.toggle("visible",i>480)}function r(){n&&n.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})})}function l(){const i=window.MIROZA.utils.qsa(".single-article img, main img[data-enhance-responsive]");i.length&&i.forEach(s=>{s&&(s.getAttribute("loading")||(s.loading="lazy"),s.decoding="async")})}function a(){o=window.MIROZA.utils.qs(".site-header"),n=window.MIROZA.utils.qs(".back-to-top"),r(),window.addEventListener("scroll",()=>{t||(t=!0,window.requestAnimationFrame(()=>{e(),t=!1}))},{passive:!0}),e(),l()}return{init:a}}(),window.MIROZA.search=function(){function o(){const n=window.MIROZA.utils.qs("#search"),t=window.MIROZA.utils.qs("#search-suggestions");!n||!t||!window.MIROZA.store||(n.addEventListener("input",window.MIROZA.utils.debounce(e=>{const r=e.target.value.toLowerCase();if(r.length<2){t.hidden=!0;return}const a=window.MIROZA.store.getAll().filter(i=>(i.title||"").toLowerCase().includes(r)).slice(0,5);t.innerHTML="",a.length?(t.hidden=!1,a.forEach(i=>{const s=document.createElement("button");s.className="search-suggestion",s.innerHTML=`<strong>${window.MIROZA.utils.safeHTML(i.title)}</strong><br><span>${window.MIROZA.utils.safeHTML(i.category||"")}</span>`,s.addEventListener("click",()=>{window.location.href=i.link||`/articles/${i.slug}.html`}),t.appendChild(s)})):t.hidden=!0},300)),document.addEventListener("click",e=>{!n.contains(e.target)&&!t.contains(e.target)&&(t.hidden=!0)}))}return{init:o}}(),window.MIROZA.subscription=function(){function o(){const e=window.MIROZA.utils.qs("#newsletter-form");if(!e)return;if(!e.querySelector('input[type="email"]')){const l=document.createElement("input");l.type="email",l.placeholder="Your email address",l.required=!0,l.setAttribute("aria-label","Email address"),e.insertBefore(l,e.querySelector("button"))}e.addEventListener("submit",l=>{l.preventDefault();const a=e.querySelector('input[type="email"]'),i=a.value.trim();if(!i)return;n(i);const s=e.querySelector("button").textContent;e.querySelector("button").textContent="Subscribed!",e.querySelector("button").disabled=!0,a.value="",setTimeout(()=>{e.querySelector("button").textContent=s,e.querySelector("button").disabled=!1},3e3)});const r=window.MIROZA.utils.qs(".newsletter h3");r&&(r.addEventListener("dblclick",t),r.title="Admin: Double click to download subscriber list")}function n(e){let r=[];try{const a=localStorage.getItem(M);a&&(r=JSON.parse(a))}catch(a){}const l={email:e,date:new Date().toISOString(),source:"newsletter-form"};r.push(l),localStorage.setItem(M,JSON.stringify(r)),console.log("Subscriber saved locally:",l)}function t(){let e=[];try{const d=localStorage.getItem(M);d&&(e=JSON.parse(d))}catch(d){}if(!e.length){alert("No subscribers yet.");return}const r=`Email,Date,Source
`,l=e.map(d=>`${d.email},${d.date},${d.source}`).join(`
`),a=new Blob([r+l],{type:"text/csv"}),i=URL.createObjectURL(a),s=document.createElement("a");s.href=i,s.download="subscribers.csv",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(i)}return{init:o}}(),window.MIROZA.home=function(){function o(t,e){const r=window.MIROZA.utils.qs(`#${t}`);r&&(r.innerHTML="",e.forEach(l=>{r.appendChild(window.MIROZA.builder.build(l))}))}function n(){if(!window.MIROZA.store)return;const t=window.MIROZA.store.getAll();if(!t||!t.length)return;let e=[];try{fetch("/data/news.json").then(i=>i.ok?i.json():[]).then(i=>{if(i&&i.length){const d=i.slice().sort((u,w)=>(w.date||"").localeCompare(u.date||"")).slice(0,4).map(u=>({title:u.title,slug:u.slug,date:u.date,category:u.category||"News",excerpt:u.excerpt,link:u.contentFile||`/news/${u.slug}.html`,image:u.image?{src:u.image,alt:u.title}:null}));o("news-cards",d);return}const s=t.filter(d=>d.category==="News").slice(0,4);o("news-cards",s)}).catch(()=>{const i=t.filter(s=>s.category==="News").slice(0,4);o("news-cards",i)})}catch(i){const s=t.filter(d=>d.category==="News").slice(0,4);o("news-cards",s)}const r=t.filter(i=>i.category==="Blog").slice(0,4),l=t.filter(i=>i.category!=="News"&&i.category!=="Blog").slice(0,4);o("blog-cards",r),o("articles-cards",l);const a=window.MIROZA.utils.shuffle(t.slice(0)).slice(0,8);o("latest-cards",a)}return{init:n}}(),window.MIROZA.indiaNews=function(){function o(t){return{title:t.title,slug:t.slug,date:t.date,category:"India",excerpt:t.excerpt,link:t.contentFile||`/news/${t.slug}.html`,image:t.image?{src:t.image,alt:t.title}:null}}function n(){const t=window.MIROZA.utils.qs("#india-news-list");t&&fetch("/data/news.json").then(e=>e.ok?e.json():[]).then(e=>{t.innerHTML="",e.slice().sort((r,l)=>(l.date||"").localeCompare(r.date||"")).forEach(r=>{t.appendChild(window.MIROZA.builder.build(o(r)))})}).catch(()=>{t.innerHTML="<p>Unable to load latest India news right now.</p>"})}return{init:n}}(),window.MIROZA.listing=function(){function o(){try{const a=new URLSearchParams(window.location.search),i=parseInt(a.get("page"),10);return isNaN(i)||i<1?1:i}catch(a){return 1}}function n(a){try{const i=new URL(window.location.href);i.searchParams.set("page",String(a)),window.history.replaceState({},"",i.toString())}catch(i){}}function t(a,i,s=12,d=null){const u=window.MIROZA.utils.qs(a);if(!u)return null;u.innerHTML="";const w=d||o()||1,c={items:i,pageSize:s,index:(w-1)*s};c.index>0&&c.items.slice(0,c.index).forEach(f=>u.appendChild(window.MIROZA.builder.build(f)));function g(){const m=c.items.slice(c.index,c.index+c.pageSize);return m.forEach(f=>u.appendChild(window.MIROZA.builder.build(f))),c.index+=m.length,c.index<c.items.length}c.index===0&&g();const h=Math.ceil(c.index/c.pageSize)||1;return n(h),{renderNext:g,state:c}}function e(a,i){const s=window.MIROZA.utils.qs(a);if(!s||!i||(s.innerHTML="",i.state.index>=i.state.items.length))return;const d=document.createElement("button");d.className="load-more",d.textContent="Load more",d.addEventListener("click",()=>{const u=i.renderNext(),w=Math.ceil(i.state.index/i.state.pageSize)||1;n(w),u||d.remove()}),s.appendChild(d)}function r(){const a="#category-list",i="#category-pagination";if(!window.MIROZA.store||!window.MIROZA.utils.qs(a))return;const s=window.MIROZA.store.getAll();if(!s||!s.length)return;const d=s.filter(w=>w.category!=="Blog").slice().sort((w,c)=>(c.date||"").localeCompare(w.date||"")),u=t(a,d,12);e(i,u)}async function l(){const a="#category-list",i="#category-pagination";if(window.MIROZA.utils.qs(a))try{const s=await fetch("/data/blogs.json"),u=(s.ok?await s.json():[]).slice().sort((c,g)=>(g.date||"").localeCompare(c.date||"")).map(c=>({title:c.title,slug:c.slug,date:c.date,category:"Blog",excerpt:c.excerpt,link:c.url||c.contentFile||`/blogs/${c.slug}.html`,image:c.image?{src:c.image,alt:c.title}:null})),w=t(a,u,12);e(i,w)}catch(s){console.error("Failed to load blogs.json",s)}}return{initArticles:r,initBlogs:l}}(),window.MIROZA.postMeta=function(){function o(){var g,h,m,f,A,b,I;const n=document.body.dataset.page||"";if(!/article|news-article|blog-article/.test(n)||document.querySelector('script[type="application/ld+json"]'))return;const t=((g=document.querySelector('meta[property="og:title"]'))==null?void 0:g.getAttribute("content"))||document.title,e=((h=document.querySelector('meta[name="description"]'))==null?void 0:h.getAttribute("content"))||((m=document.querySelector('meta[property="og:description"]'))==null?void 0:m.getAttribute("content"))||"",r=((f=document.querySelector('meta[property="og:image"]'))==null?void 0:f.getAttribute("content"))||((A=document.querySelector("img"))==null?void 0:A.src)||"",l=((b=document.querySelector('link[rel="canonical"]'))==null?void 0:b.href)||window.location.href,a=document.querySelector(".single-article time")||document.querySelector(".meta time"),i=a?a.getAttribute("datetime")||a.textContent:((I=document.querySelector('meta[property="article:published_time"]'))==null?void 0:I.getAttribute("content"))||"",s=document.querySelector(".author")||document.querySelector('meta[name="author"]'),d=s?s.textContent||s.getAttribute("content"):"",w={"@context":"https://schema.org","@type":n==="blog-article"||n==="blog"?"BlogPosting":"NewsArticle",headline:t,description:e,image:r,datePublished:i||void 0,author:d?{"@type":"Person",name:d}:void 0,publisher:{"@type":"Organization",name:"MIROZA",logo:{"@type":"ImageObject",url:location.origin+"/assets/icons/logo.svg"}},mainEntityOfPage:{"@type":"WebPage","@id":l}};Object.keys(w).forEach(y=>w[y]===void 0&&delete w[y]);const c=document.createElement("script");c.type="application/ld+json",c.text=JSON.stringify(w,null,2),document.head.appendChild(c)}return{init:o}}(),document.addEventListener("DOMContentLoaded",()=>{window.MIROZA.theme.init(),window.MIROZA.nav.init(),window.MIROZA.ui.init(),window.MIROZA.subscription.init();const o=window.MIROZA.utils.qs(".theme-toggle");o&&o.addEventListener("click",window.MIROZA.theme.toggle);const n=document.body.dataset.page||"home",t=n==="home",e=n==="india-news",r=n==="articles",l=n==="blog";window.MIROZA.store&&typeof window.MIROZA.store.init=="function"?window.MIROZA.store.init().then(()=>{t&&window.MIROZA.home&&window.MIROZA.home.init(),r&&window.MIROZA.listing&&window.MIROZA.listing.initArticles(),l&&window.MIROZA.listing&&window.MIROZA.listing.initBlogs(),window.MIROZA.search&&window.MIROZA.search.init(),e&&window.MIROZA.indiaNews&&window.MIROZA.indiaNews.init(),window.MIROZA.postMeta&&window.MIROZA.postMeta.init(),document.body.classList.add("js-ready")}).catch(()=>{e&&window.MIROZA.indiaNews&&window.MIROZA.indiaNews.init(),window.MIROZA.postMeta&&window.MIROZA.postMeta.init(),document.body.classList.add("js-ready")}):(e&&window.MIROZA.indiaNews&&window.MIROZA.indiaNews.init(),l&&window.MIROZA.listing&&window.MIROZA.listing.initBlogs(),window.MIROZA.postMeta&&window.MIROZA.postMeta.init(),document.body.classList.add("js-ready"))}),window.MIROZA.loadPosts=async()=>(await window.MIROZA.store.init(),window.MIROZA.store.getAll()),window.MIROZA.buildCard=window.MIROZA.builder.build})();


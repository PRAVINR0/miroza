(function(){"use strict";const A="theme",M="miroza_subscribers",O="subscribers.txt",R="https://miroza.online";window.MIROZA=window.MIROZA||{},window.MIROZA.utils={qs:(i,t=document)=>t.querySelector(i),qsa:(i,t=document)=>Array.from(t.querySelectorAll(i)),shuffle(i){let t=i.length,o,e;for(;t;)e=Math.floor(Math.random()*t--),o=i[t],i[t]=i[e],i[e]=o;return i},safeHTML(i){if(window.DOMPurify)return DOMPurify.sanitize(i,{USE_PROFILES:{html:!0}});const t=document.createElement("div");return t.textContent=i,t.innerHTML},formatNumber(i){try{return Intl.NumberFormat("en-US",{notation:"compact",maximumFractionDigits:1}).format(i||0)}catch(t){return i||0}},debounce(i,t){let o;return function(...e){clearTimeout(o),o=setTimeout(()=>i.apply(this,e),t)}}},window.MIROZA.store=function(){let i=[],t=null;function o(){return t||(t=Promise.all([fetch("/data/posts.json").then(e=>e.ok?e.json():[])]).then(([e])=>(i=e,!0)).catch(e=>(console.error("Failed to load data:",e),!1)),t)}return{init:o,ready:()=>t,getAll:()=>i,getByCategory:e=>i.filter(r=>r.category===e)}}(),window.MIROZA.builder=function(){function i(t){const o=document.createElement("article");o.className="card";const e=t.image,r=e?typeof e=="string"?e:e.src||"/assets/images/hero-insight-800.svg":"/assets/images/hero-insight-800.svg",l=e&&typeof e=="object"&&e.alt?e.alt:t.title||"";let a=t.link||t.url||"";a||(t.slug?a=t.category&&t.category.toLowerCase()==="blog"?`/blogs/${t.slug}.html`:`/articles/${t.slug}.html`:a="/");let n="",s="";e&&typeof e=="object"&&(e.srcset&&(n=`srcset="${e.srcset}"`),e.sizes&&(s=`sizes="${e.sizes}"`));const c=`
        <a href="${a}" class="card-link" aria-label="Read ${window.MIROZA.utils.safeHTML(t.title||"")}">
          <img src="${r}" ${n} ${s} alt="${window.MIROZA.utils.safeHTML(l)}" loading="lazy" decoding="async" width="400" height="225" onerror="this.onerror=null;this.src='/assets/images/hero-insight-800.svg'" />
        </a>
        <div class="card-content">
          <div class="card-meta">
            <span class="category">${window.MIROZA.utils.safeHTML(t.category||"Story")}</span> \u2022
            <span class="date">${t.date?new Date(t.date).toLocaleDateString():""}</span>
          </div>
          <h3 class="card-title">
            <a href="${a}">${window.MIROZA.utils.safeHTML(t.title||"")}</a>
          </h3>
          <p class="card-excerpt">${window.MIROZA.utils.safeHTML(t.excerpt||"")}</p>
          <a href="${a}" class="read-more" aria-hidden="true">Read Article</a>
        </div>
      `;return o.innerHTML=c,o}return{build:i}}(),window.MIROZA.theme=function(){function i(){const e=localStorage.getItem(A);e?document.documentElement.dataset.theme=e:window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches&&(document.documentElement.dataset.theme="dark"),o()}function t(){const r=(document.documentElement.dataset.theme||"light")==="dark"?"light":"dark";document.documentElement.dataset.theme=r,localStorage.setItem(A,r),o()}function o(){const e=window.MIROZA.utils.qs(".theme-toggle img");if(e){const r=document.documentElement.dataset.theme==="dark";e.src=r?"/assets/icons/sun.svg":"/assets/icons/moon.svg",e.alt=r?"Switch to light mode":"Switch to dark mode"}}return{init:i,toggle:t}}(),window.MIROZA.nav=function(){let i=!1;function t(){const o=window.MIROZA.utils.qs(".menu-toggle"),e=window.MIROZA.utils.qs(".main-nav");!o||!e||(o.addEventListener("click",()=>{i=!i,e.classList.toggle("open",i),o.setAttribute("aria-expanded",i),o.innerHTML=i?'<img src="/assets/icons/close.svg" alt="Close" width="24" height="24" />':'<img src="/assets/icons/menu.svg" alt="Menu" width="24" height="24" />'}),e.addEventListener("click",r=>{r.target.tagName==="A"&&(i=!1,e.classList.remove("open"),o.setAttribute("aria-expanded","false"),o.innerHTML='<img src="/assets/icons/menu.svg" alt="Menu" width="24" height="24" />')}))}return{init:t}}(),window.MIROZA.ui=function(){let i,t,o=!1;function e(){const n=window.scrollY||document.documentElement.scrollTop||0;i&&i.classList.toggle("is-stuck",n>24),t&&t.classList.toggle("visible",n>480)}function r(){t&&t.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})})}function l(){const n=window.MIROZA.utils.qsa(".single-article img, main img[data-enhance-responsive]");n.length&&n.forEach(s=>{s&&(s.getAttribute("loading")||(s.loading="lazy"),s.decoding="async")})}function a(){i=window.MIROZA.utils.qs(".site-header"),t=window.MIROZA.utils.qs(".back-to-top"),r(),window.addEventListener("scroll",()=>{o||(o=!0,window.requestAnimationFrame(()=>{e(),o=!1}))},{passive:!0}),e(),l()}return{init:a}}(),window.MIROZA.search=function(){function i(){const t=window.MIROZA.utils.qs("#search"),o=window.MIROZA.utils.qs("#search-suggestions");!t||!o||!window.MIROZA.store||(t.addEventListener("input",window.MIROZA.utils.debounce(e=>{const r=e.target.value.toLowerCase();if(r.length<2){o.hidden=!0;return}const a=window.MIROZA.store.getAll().filter(n=>(n.title||"").toLowerCase().includes(r)).slice(0,5);o.innerHTML="",a.length?(o.hidden=!1,a.forEach(n=>{const s=document.createElement("button");s.className="search-suggestion",s.innerHTML=`<strong>${window.MIROZA.utils.safeHTML(n.title)}</strong><br><span>${window.MIROZA.utils.safeHTML(n.category||"")}</span>`,s.addEventListener("click",()=>{window.location.href=n.link||`/articles/${n.slug}.html`}),o.appendChild(s)})):o.hidden=!0},300)),document.addEventListener("click",e=>{!t.contains(e.target)&&!o.contains(e.target)&&(o.hidden=!0)}))}return{init:i}}(),window.MIROZA.subscription=function(){function i(){const e=window.MIROZA.utils.qs("#newsletter-form");if(!e)return;if(!e.querySelector('input[type="email"]')){const l=document.createElement("input");l.type="email",l.placeholder="Your email address",l.required=!0,l.setAttribute("aria-label","Email address"),e.insertBefore(l,e.querySelector("button"))}e.addEventListener("submit",l=>{l.preventDefault();const a=e.querySelector('input[type="email"]'),n=a.value.trim();if(!n)return;t(n);const s=e.querySelector("button").textContent;e.querySelector("button").textContent="Subscribed!",e.querySelector("button").disabled=!0,a.value="",setTimeout(()=>{e.querySelector("button").textContent=s,e.querySelector("button").disabled=!1},3e3)});const r=window.MIROZA.utils.qs(".newsletter h3");r&&(r.addEventListener("dblclick",o),r.title="Admin: Double click to download subscriber list")}function t(e){let r=[];try{const a=localStorage.getItem(M);a&&(r=JSON.parse(a))}catch(a){}const l={email:e,date:new Date().toISOString(),source:"newsletter-form"};r.push(l),localStorage.setItem(M,JSON.stringify(r)),console.log("Subscriber saved locally:",l)}function o(){let e=[];try{const c=localStorage.getItem(M);c&&(e=JSON.parse(c))}catch(c){}if(!e.length){alert("No subscribers yet.");return}const r=`Email,Date,Source
`,l=e.map(c=>`${c.email},${c.date},${c.source}`).join(`
`),a=new Blob([r+l],{type:"text/csv"}),n=URL.createObjectURL(a),s=document.createElement("a");s.href=n,s.download="subscribers.csv",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(n)}return{init:i}}(),window.MIROZA.home=function(){function i(o,e){const r=window.MIROZA.utils.qs(`#${o}`);r&&(r.innerHTML="",e.forEach(l=>{r.appendChild(window.MIROZA.builder.build(l))}))}function t(){if(!window.MIROZA.store)return;const o=window.MIROZA.store.getAll();if(!o||!o.length)return;let e=[];try{fetch("/data/news.json").then(n=>n.ok?n.json():[]).then(n=>{if(n&&n.length){const c=n.slice().sort((d,g)=>(g.date||"").localeCompare(d.date||"")).slice(0,4).map(d=>({title:d.title,slug:d.slug,date:d.date,category:d.category||"News",excerpt:d.excerpt,link:d.contentFile||`/news/${d.slug}.html`,image:d.image?{src:d.image,alt:d.title}:null}));i("news-cards",c);return}const s=o.filter(c=>c.category==="News").slice(0,4);i("news-cards",s)}).catch(()=>{const n=o.filter(s=>s.category==="News").slice(0,4);i("news-cards",n)})}catch(n){const s=o.filter(c=>c.category==="News").slice(0,4);i("news-cards",s)}const r=o.filter(n=>n.category==="Blog").slice(0,4),l=o.filter(n=>n.category!=="News"&&n.category!=="Blog").slice(0,4);i("blog-cards",r),i("articles-cards",l);const a=window.MIROZA.utils.shuffle(o.slice(0)).slice(0,8);i("latest-cards",a)}return{init:t}}(),window.MIROZA.indiaNews=function(){function i(e){return{title:e.title,slug:e.slug,date:e.date,category:"India",excerpt:e.excerpt,link:e.contentFile||`/news/${e.slug}.html`,image:e.image?{src:e.image,alt:e.title}:null}}function t(){try{return new URLSearchParams(window.location.search).get("topic")}catch(e){return null}}function o(){const e=window.MIROZA.utils.qs("#india-news-list");e&&fetch("/data/news.json").then(r=>r.ok?r.json():[]).then(r=>{e.innerHTML="";let l=r.slice().sort((n,s)=>(s.date||"").localeCompare(n.date||""));const a=t();if(a&&(l=l.filter(n=>(n.category||"").toLowerCase()===a.toLowerCase()||(n.title||"").toLowerCase().includes(a.toLowerCase()))),l.length===0){e.innerHTML="<p>No news found for this topic.</p>";return}l.forEach(n=>{e.appendChild(window.MIROZA.builder.build(i(n)))})}).catch(()=>{e.innerHTML="<p>Unable to load latest India news right now.</p>"})}return{init:o}}(),window.MIROZA.listing=function(){function i(){try{const n=new URLSearchParams(window.location.search),s=parseInt(n.get("page"),10);return isNaN(s)||s<1?1:s}catch(n){return 1}}function t(){try{return new URLSearchParams(window.location.search).get("topic")}catch(n){return null}}function o(n){try{const s=new URL(window.location.href);s.searchParams.set("page",String(n)),window.history.replaceState({},"",s.toString())}catch(s){}}function e(n,s,c=12,d=null){const g=window.MIROZA.utils.qs(n);if(!g)return null;g.innerHTML="";const m=d||i()||1,u={items:s,pageSize:c,index:(m-1)*c};u.index>0&&u.items.slice(0,u.index).forEach(p=>g.appendChild(window.MIROZA.builder.build(p)));function w(){const h=u.items.slice(u.index,u.index+u.pageSize);return h.forEach(p=>g.appendChild(window.MIROZA.builder.build(p))),u.index+=h.length,u.index<u.items.length}u.index===0&&w();const f=Math.ceil(u.index/u.pageSize)||1;return o(f),{renderNext:w,state:u}}function r(n,s){const c=window.MIROZA.utils.qs(n);if(!c||!s||(c.innerHTML="",s.state.index>=s.state.items.length))return;const d=document.createElement("button");d.className="load-more",d.textContent="Load more",d.addEventListener("click",()=>{const g=s.renderNext(),m=Math.ceil(s.state.index/s.state.pageSize)||1;o(m),g||d.remove()}),c.appendChild(d)}function l(){const n="#category-list",s="#category-pagination";if(!window.MIROZA.store||!window.MIROZA.utils.qs(n))return;const c=window.MIROZA.store.getAll();if(!c||!c.length)return;const d=t();let g=c.filter(u=>u.category!=="Blog").slice().sort((u,w)=>(w.date||"").localeCompare(u.date||""));d&&(g=g.filter(u=>(u.category||"").toLowerCase()===d.toLowerCase()||(u.title||"").toLowerCase().includes(d.toLowerCase())));const m=e(n,g,12);r(s,m)}async function a(){const n="#category-list",s="#category-pagination";if(window.MIROZA.utils.qs(n))try{const c=await fetch("/data/blogs.json");let g=(c.ok?await c.json():[]).slice().sort((w,f)=>(f.date||"").localeCompare(w.date||"")).map(w=>({title:w.title,slug:w.slug,date:w.date,category:"Blog",excerpt:w.excerpt,link:w.url||w.contentFile||`/blogs/${w.slug}.html`,image:w.image?{src:w.image,alt:w.title}:null}));const m=t();m&&(g=g.filter(w=>(w.title||"").toLowerCase().includes(m.toLowerCase())));const u=e(n,g,12);r(s,u)}catch(c){console.error("Failed to load blogs.json",c)}}return{initArticles:l,initBlogs:a}}(),window.MIROZA.postMeta=function(){function i(){var u,w,f,h,p,b,y;const t=document.body.dataset.page||"";if(!/article|news-article|blog-article/.test(t)||document.querySelector('script[type="application/ld+json"]'))return;const o=((u=document.querySelector('meta[property="og:title"]'))==null?void 0:u.getAttribute("content"))||document.title,e=((w=document.querySelector('meta[name="description"]'))==null?void 0:w.getAttribute("content"))||((f=document.querySelector('meta[property="og:description"]'))==null?void 0:f.getAttribute("content"))||"",r=((h=document.querySelector('meta[property="og:image"]'))==null?void 0:h.getAttribute("content"))||((p=document.querySelector("img"))==null?void 0:p.src)||"",l=((b=document.querySelector('link[rel="canonical"]'))==null?void 0:b.href)||window.location.href,a=document.querySelector(".single-article time")||document.querySelector(".meta time"),n=a?a.getAttribute("datetime")||a.textContent:((y=document.querySelector('meta[property="article:published_time"]'))==null?void 0:y.getAttribute("content"))||"",s=document.querySelector(".author")||document.querySelector('meta[name="author"]'),c=s?s.textContent||s.getAttribute("content"):"",g={"@context":"https://schema.org","@type":t==="blog-article"||t==="blog"?"BlogPosting":"NewsArticle",headline:o,description:e,image:r,datePublished:n||void 0,author:c?{"@type":"Person",name:c}:void 0,publisher:{"@type":"Organization",name:"MIROZA",logo:{"@type":"ImageObject",url:location.origin+"/assets/icons/logo.svg"}},mainEntityOfPage:{"@type":"WebPage","@id":l}};Object.keys(g).forEach(I=>g[I]===void 0&&delete g[I]);const m=document.createElement("script");m.type="application/ld+json",m.text=JSON.stringify(g,null,2),document.head.appendChild(m)}return{init:i}}(),document.addEventListener("DOMContentLoaded",()=>{window.MIROZA.theme.init(),window.MIROZA.nav.init(),window.MIROZA.ui.init(),window.MIROZA.subscription.init();const i=window.MIROZA.utils.qs(".theme-toggle");i&&i.addEventListener("click",window.MIROZA.theme.toggle);const t=document.body.dataset.page||"home",o=t==="home",e=t==="india-news",r=t==="articles",l=t==="blog";window.MIROZA.store&&typeof window.MIROZA.store.init=="function"?window.MIROZA.store.init().then(()=>{o&&window.MIROZA.home&&window.MIROZA.home.init(),r&&window.MIROZA.listing&&window.MIROZA.listing.initArticles(),l&&window.MIROZA.listing&&window.MIROZA.listing.initBlogs(),window.MIROZA.search&&window.MIROZA.search.init(),e&&window.MIROZA.indiaNews&&window.MIROZA.indiaNews.init(),window.MIROZA.postMeta&&window.MIROZA.postMeta.init(),document.body.classList.add("js-ready")}).catch(()=>{e&&window.MIROZA.indiaNews&&window.MIROZA.indiaNews.init(),window.MIROZA.postMeta&&window.MIROZA.postMeta.init(),document.body.classList.add("js-ready")}):(e&&window.MIROZA.indiaNews&&window.MIROZA.indiaNews.init(),l&&window.MIROZA.listing&&window.MIROZA.listing.initBlogs(),window.MIROZA.postMeta&&window.MIROZA.postMeta.init(),document.body.classList.add("js-ready"));try{const a=(location.pathname||"").toLowerCase(),n=a.indexOf("/articles/")===0&&!/articles(\/|index\.html|articles\.html)$/.test(a),s=a.indexOf("/blogs/")===0&&!/blogs(\/|index\.html|blogs\.html)$/.test(a);if(n||s){const c=document.createElement("script");c.src="/scripts/article-nav.js",c.defer=!0,document.body.appendChild(c)}}catch(a){}}),window.MIROZA.loadPosts=async()=>(await window.MIROZA.store.init(),window.MIROZA.store.getAll()),window.MIROZA.buildCard=window.MIROZA.builder.build})();

!function(n){var e={postsUrl:"/data/posts.json",latestPerCategory:4,swPath:"/sw.js"};n.MIROZA=n.MIROZA||{},n.MIROZA.config=Object.assign(e,n.MIROZA?.config||{}),n.MIROZA._cache={html:{}};var t=n.MIROZA;t.initTheme=function(){var e=document.getElementById("themeToggle");e&&e.addEventListener("click",t.toggleTheme)},t.toggleTheme=function(){var e=document.documentElement.classList.toggle("theme-dark");try{localStorage.setItem("miroza_theme",e?"dark":"light")}catch(n){}},t.loadPosts=async function(){try{var e=await fetch(t.config.postsUrl,{cache:"no-cache"});if(!e.ok)throw new Error("posts fetch failed");var n=await e.json();return n.posts||[]}catch(e){return console.warn(e),[]}},t.shuffle=function(n){for(var e=n.slice(),o=e.length-1;o>0;o--){var r=Math.floor(Math.random()*(o+1));[e[o],e[r]]=[e[r],e[o]]}return e},t.renderCard=function(e){var o=document.createElement("article");o.className="card";var r=document.createElement("img");r.setAttribute("data-src",e.image),r.alt=e.title,r.loading="lazy",r.className="lazy",o.appendChild(r);var a=document.createElement("div");a.className="card-body";var i=document.createElement("h3"),c=document.createElement("a");c.href="/articles/"+e.slug+".html",c.textContent=e.title,c.setAttribute("rel","noopener noreferrer"),i.appendChild(c);var l=document.createElement("p");l.className="muted",l.textContent=e.author+" â€¢ "+new Date(e.date).toLocaleDateString();var s=document.createElement("p");s.className="excerpt",s.textContent=e.excerpt,a.appendChild(i),a.appendChild(l),a.appendChild(s),o.appendChild(a);return o},t.renderCards=function(n,e){n.innerHTML="",e.forEach(function(e){n.appendChild(t.renderCard(e))}),t.lazyLoadImages()},t.lazyLoadImages=function(){var n=document.querySelectorAll("img.lazy");if("IntersectionObserver"in window){var e=new IntersectionObserver(function(n,o){n.forEach(function(n){if(n.isIntersecting){var o=n.target;o.src=o.getAttribute("data-src")||o.src,o.classList.remove("lazy"),oObserver&&oObserver.unobserve(o)}});});var o; n.forEach(function(n){e.observe(n)});var oObserver=e}else n.forEach(function(n){n.src=n.getAttribute("data-src")||n.src,n.classList.remove("lazy")});document.querySelectorAll("img").forEach(function(n){n.addEventListener("error",function(){n.src="/assets/hero-1.svg",n.alt="placeholder image"})})},t.prefetch=async function(n){if(t._cache.html[n])return t._cache.html[n];try{var e=await fetch(n,{credentials:"same-origin"});if(!e.ok)throw new Error("prefetch failed");var o=await e.text();return t._cache.html[n]=o,o}catch(n){return null}},t.navigate=async function(e,o){var r=performance.now();document.documentElement.classList.add("is-transitioning");try{var a=t._cache.html[e]||await t.prefetch(e);if(!a){window.location.href=e;return}var i=document.createElement("div");i.innerHTML=a;var c=i.querySelector("main");if(!c){window.location.href=e;return}var l=document.querySelector("main");l.replaceWith(c);var s=i.querySelector("title");s&&(document.title=s.textContent);var u=i.querySelector("meta[name=\"description\"]");if(u){var d=document.querySelector("meta[name=\"description\"]");d?d.setAttribute("content",u.getAttribute("content")):document.head.appendChild(u.cloneNode(!0))}o&&history.pushState({url:e},"",e);c.setAttribute("tabindex","-1"),c.focus(),c.removeAttribute("tabindex"),t.lazyLoadImages(),document.getElementById("liveRegion")?.textContent="Loaded content for "+(i.querySelector("h1")?.textContent||e)}catch(n){console.error("PJAX error",n),window.location.href=e}finally{document.documentElement.classList.remove("is-transitioning"),console.log("navigate took",performance.now()-r,"ms")}},t.initRouter=function(){document.addEventListener("mouseover",function(n){var e=n.target.closest&&n.target.closest("a");e&&e.href&&e.origin===location.origin&&t.prefetch(e.href)}),document.addEventListener("click",function(n){var e=n.target.closest&&n.target.closest("a");if(!e)return;var o=e.getAttribute("href");if(!o||o.startsWith("#")||o.startsWith("mailto:")||o.startsWith("tel:"))return; if(e.target==="_blank")return;e.origin!==location.origin|| (n.preventDefault(),t.navigate(e.href,!0))}),window.addEventListener("popstate",function(){t.navigate(location.href,!1)})},t.initSearch=function(){var n=document.getElementById("searchInput"),e=document.getElementById("searchResults");if(!n)return;var o=null;n.addEventListener("input",async function(n){var r=n.target.value.trim().toLowerCase();if(r.length<2){e&&(e.innerHTML="");return}o||(o=await t.loadPosts());var a=o.filter(function(n){return(n.title+n.excerpt+n.author).toLowerCase().includes(r)}).slice(0,8);e&&(e.innerHTML="",a.forEach(function(n){var o=document.createElement("div");o.className="search-item";var r=document.createElement("a");r.href="/articles/"+n.slug+".html",r.textContent=n.title,o.appendChild(r),e.appendChild(o)}))})},t.init=function(){t.initTheme(),t.initRouter(),t.initSearch(),t.lazyLoadImages();var n=document.getElementById("backToTop");n&&(window.addEventListener("scroll",function(){window.scrollY>400?n.classList.add("show"):n.classList.remove("show")}),n.addEventListener("click",function(){window.scrollTo({top:0,behavior:"smooth"})}));if(!document.getElementById("liveRegion")){var e=document.createElement("div");e.id="liveRegion",e.setAttribute("aria-live","polite"),e.style.position="absolute",e.style.left="-9999px",document.body.appendChild(e)}if("serviceWorker"in navigator)try{navigator.serviceWorker.register(t.config.swPath)}catch(n){console.warn("SW",n)}},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",t.init):t.init(),window.MIROZA=t}(window.MIROZA||{});
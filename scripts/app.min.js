(function(){"use strict";const A="theme",M="miroza_subscribers",O="https://miroza.online";window.MIROZA=window.MIROZA||{},window.MIROZA.utils={qs:(i,n=document)=>n.querySelector(i),qsa:(i,n=document)=>Array.from(n.querySelectorAll(i)),shuffle(i){let n=i.length,s,t;for(;n;)t=Math.floor(Math.random()*n--),s=i[n],i[n]=i[t],i[t]=s;return i},safeHTML(i){if(window.DOMPurify)return DOMPurify.sanitize(i,{USE_PROFILES:{html:!0}});const n=document.createElement("div");return n.textContent=i,n.innerHTML},formatNumber(i){try{return Intl.NumberFormat("en-US",{notation:"compact",maximumFractionDigits:1}).format(i||0)}catch(n){return i||0}},debounce(i,n){let s;return function(...t){clearTimeout(s),s=setTimeout(()=>i.apply(this,t),n)}}},window.MIROZA.store=function(){let i=[],n=null;function s(){return n||(n=Promise.all([fetch("/data/posts.json").then(t=>t.ok?t.json():[])]).then(([t])=>(i=t,!0)).catch(t=>(console.error("Failed to load data:",t),!1)),n)}return{init:s,ready:()=>n,getAll:()=>i,getByCategory:t=>i.filter(r=>r.category===t)}}(),window.MIROZA.builder=function(){function i(n){const s=document.createElement("article");s.className="card post-card";const t=n.image,r=t?typeof t=="string"?t:t.src||"/assets/images/hero-insight-800.svg":"/assets/images/hero-insight-800.svg",l=t&&typeof t=="object"&&t.alt?t.alt:n.title||"";let a=n.link||n.url||"";if(!a)if(n.slug){const d=(n.category||"").toLowerCase();d==="blog"?a=`/blogs/${n.slug}.html`:d==="news"||d==="india"?a=`/news/${n.slug}.html`:a=`/articles/${n.slug}.html`}else a="/";let e="",o="";t&&typeof t=="object"&&(t.srcset&&(e=`srcset="${t.srcset}"`),t.sizes&&(o=`sizes="${t.sizes}"`));const c=`
        <a href="${a}" class="card-link" aria-label="Read ${window.MIROZA.utils.safeHTML(n.title||"")}">
          <div class="card-image-wrap">
             <img src="${r}" ${e} ${o} alt="${window.MIROZA.utils.safeHTML(l)}" loading="lazy" decoding="async" width="400" height="225" onerror="this.onerror=null;this.src='/assets/images/hero-insight-800.svg'" />
          </div>
          <div class="card-content card-body">
            <div class="card-meta">
              <span class="category">${window.MIROZA.utils.safeHTML(n.category||"Story")}</span> \u2022
              <span class="date">${n.date?new Date(n.date).toLocaleDateString():""}</span>
            </div>
            <h3 class="card-title">
              ${window.MIROZA.utils.safeHTML(n.title||"")}
            </h3>
            <p class="card-excerpt">${window.MIROZA.utils.safeHTML(n.excerpt||"")}</p>
            <span class="read-more" aria-hidden="true">Read Article</span>
          </div>
        </a>
      `;return s.innerHTML=c,s}return{build:i}}(),window.MIROZA.theme=function(){function i(){const t=localStorage.getItem(A);t?document.documentElement.dataset.theme=t:window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches&&(document.documentElement.dataset.theme="dark"),s()}function n(){const r=(document.documentElement.dataset.theme||"light")==="dark"?"light":"dark";document.documentElement.dataset.theme=r,localStorage.setItem(A,r),s()}function s(){const t=window.MIROZA.utils.qs(".theme-toggle img");if(t){const r=document.documentElement.dataset.theme==="dark";t.src=r?"/assets/icons/sun.svg":"/assets/icons/moon.svg",t.alt=r?"Switch to light mode":"Switch to dark mode"}}return{init:i,toggle:n}}(),window.MIROZA.nav=function(){let i=!1;function n(){const t=window.location.pathname,r=window.MIROZA.utils.qsa(".main-nav a");let l=!1;r.forEach(a=>{const e=a.getAttribute("href");t===e||t==="/"&&e==="/index.html"||t==="/index.html"&&e==="/"?(a.setAttribute("aria-current","page"),l=!0):a.removeAttribute("aria-current")}),!l&&r.forEach(a=>{const e=a.getAttribute("href");if(e==="/"||e==="/index.html")return;const o=e.split("/")[1];o&&t.includes(`/${o}/`)&&a.setAttribute("aria-current","page")})}function s(){n();const t=window.MIROZA.utils.qs(".menu-toggle"),r=window.MIROZA.utils.qs(".main-nav");!t||!r||(t.addEventListener("click",()=>{i=!i,r.classList.toggle("open",i),t.setAttribute("aria-expanded",i),t.innerHTML=i?'<img src="/assets/icons/close.svg" alt="Close" width="24" height="24" />':'<img src="/assets/icons/menu.svg" alt="Menu" width="24" height="24" />'}),r.addEventListener("click",l=>{l.target.tagName==="A"&&(i=!1,r.classList.remove("open"),t.setAttribute("aria-expanded","false"),t.innerHTML='<img src="/assets/icons/menu.svg" alt="Menu" width="24" height="24" />')}))}return{init:s}}(),window.MIROZA.ui=function(){let i,n,s=!1;function t(){const e=window.scrollY||document.documentElement.scrollTop||0;i&&i.classList.toggle("is-stuck",e>24),n&&n.classList.toggle("visible",e>480)}function r(){n&&n.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})})}function l(){const e=window.MIROZA.utils.qsa(".single-article img, main img[data-enhance-responsive]");e.length&&e.forEach(o=>{o&&(o.getAttribute("loading")||(o.loading="lazy"),o.decoding="async")})}function a(){i=window.MIROZA.utils.qs(".site-header"),n=window.MIROZA.utils.qs(".back-to-top"),r(),window.addEventListener("scroll",()=>{s||(s=!0,window.requestAnimationFrame(()=>{t(),s=!1}))},{passive:!0}),t(),l()}return{init:a}}(),window.MIROZA.search=function(){function i(){const n=window.MIROZA.utils.qs("#search"),s=window.MIROZA.utils.qs("#search-suggestions");!n||!s||!window.MIROZA.store||(n.addEventListener("input",window.MIROZA.utils.debounce(t=>{const r=t.target.value.toLowerCase();if(r.length<2){s.hidden=!0;return}const a=window.MIROZA.store.getAll().filter(e=>(e.title||"").toLowerCase().includes(r)).slice(0,5);s.innerHTML="",a.length?(s.hidden=!1,a.forEach(e=>{const o=document.createElement("button");o.className="search-suggestion",o.innerHTML=`<strong>${window.MIROZA.utils.safeHTML(e.title)}</strong><br><span>${window.MIROZA.utils.safeHTML(e.category||"")}</span>`,o.addEventListener("click",()=>{window.location.href=e.link||`/articles/${e.slug}.html`}),s.appendChild(o)})):s.hidden=!0},300)),document.addEventListener("click",t=>{!n.contains(t.target)&&!s.contains(t.target)&&(s.hidden=!0)}))}return{init:i}}(),window.MIROZA.subscription=function(){function i(){const t=window.MIROZA.utils.qs("#newsletter-form");if(!t)return;if(!t.querySelector('input[type="email"]')){const l=document.createElement("input");l.type="email",l.placeholder="Your email address",l.required=!0,l.setAttribute("aria-label","Email address"),t.insertBefore(l,t.querySelector("button"))}t.addEventListener("submit",l=>{l.preventDefault();const a=t.querySelector('input[type="email"]'),e=a.value.trim();if(!e)return;n(e);const o=t.querySelector("button").textContent;t.querySelector("button").textContent="Subscribed!",t.querySelector("button").disabled=!0,a.value="",setTimeout(()=>{t.querySelector("button").textContent=o,t.querySelector("button").disabled=!1},3e3)});const r=window.MIROZA.utils.qs(".newsletter h3");r&&(r.addEventListener("dblclick",s),r.title="Admin: Double click to download subscriber list")}function n(t){let r=[];try{const a=localStorage.getItem(M);a&&(r=JSON.parse(a))}catch(a){}const l={email:t,date:new Date().toISOString(),source:"newsletter-form"};r.push(l),localStorage.setItem(M,JSON.stringify(r)),console.log("Subscriber saved locally:",l)}function s(){let t=[];try{const c=localStorage.getItem(M);c&&(t=JSON.parse(c))}catch(c){}if(!t.length){alert("No subscribers yet.");return}const r=`Email,Date,Source
`,l=t.map(c=>`${c.email},${c.date},${c.source}`).join(`
`),a=new Blob([r+l],{type:"text/csv"}),e=URL.createObjectURL(a),o=document.createElement("a");o.href=e,o.download="subscribers.csv",document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(e)}return{init:i}}(),window.MIROZA.home=function(){function i(s,t){const r=window.MIROZA.utils.qs(`#${s}`);r&&(r.innerHTML="",t.forEach(l=>{r.appendChild(window.MIROZA.builder.build(l))}))}function n(){if(!window.MIROZA.store)return;const s=window.MIROZA.store.getAll();if(!s||!s.length)return;let t=[];try{fetch("/data/news.json").then(e=>e.ok?e.json():[]).then(e=>{if(e&&e.length){const c=e.slice().sort((d,w)=>(w.date||"").localeCompare(d.date||"")).slice(0,4).map(d=>({title:d.title,slug:d.slug,date:d.date,category:d.category||"News",excerpt:d.excerpt,link:d.contentFile||`/news/${d.slug}.html`,image:d.image?{src:d.image,alt:d.title}:null}));i("news-cards",c);return}const o=s.filter(c=>c.category==="News").slice(0,4);i("news-cards",o)}).catch(()=>{const e=s.filter(o=>o.category==="News").slice(0,4);i("news-cards",e)})}catch(e){const o=s.filter(c=>c.category==="News").slice(0,4);i("news-cards",o)}const r=s.filter(e=>e.category==="Blog").slice(0,4),l=s.filter(e=>e.category!=="News"&&e.category!=="Blog").slice(0,4);i("blog-cards",r),i("articles-cards",l);const a=window.MIROZA.utils.shuffle(s.slice(0)).slice(0,8);i("latest-cards",a)}return{init:n}}(),window.MIROZA.indiaNews=function(){function i(t){return{title:t.title,slug:t.slug,date:t.date,category:"India",excerpt:t.excerpt,link:t.contentFile||`/news/${t.slug}.html`,image:t.image?{src:t.image,alt:t.title}:null}}function n(){try{return new URLSearchParams(window.location.search).get("topic")}catch(t){return null}}function s(){const t=window.MIROZA.utils.qs("#india-news-list");t&&fetch("/data/news.json").then(r=>r.ok?r.json():[]).then(r=>{t.innerHTML="";let l=r.slice().sort((e,o)=>(o.date||"").localeCompare(e.date||""));const a=n();if(a&&(l=l.filter(e=>(e.category||"").toLowerCase()===a.toLowerCase()||(e.title||"").toLowerCase().includes(a.toLowerCase()))),l.length===0){t.innerHTML="<p>No news found for this topic.</p>";return}l.forEach(e=>{t.appendChild(window.MIROZA.builder.build(i(e)))})}).catch(()=>{t.innerHTML="<p>Unable to load latest India news right now.</p>"})}return{init:s}}(),window.MIROZA.listing=function(){function i(){try{const e=new URLSearchParams(window.location.search),o=parseInt(e.get("page"),10);return isNaN(o)||o<1?1:o}catch(e){return 1}}function n(){try{return new URLSearchParams(window.location.search).get("topic")}catch(e){return null}}function s(e){try{const o=new URL(window.location.href);o.searchParams.set("page",String(e)),window.history.replaceState({},"",o.toString())}catch(o){}}function t(e,o,c=12,d=null){const w=window.MIROZA.utils.qs(e);if(!w)return null;w.innerHTML="";const f=d||i()||1,u={items:o,pageSize:c,index:(f-1)*c};u.index>0&&u.items.slice(0,u.index).forEach(p=>w.appendChild(window.MIROZA.builder.build(p)));function m(){const h=u.items.slice(u.index,u.index+u.pageSize);return h.forEach(p=>w.appendChild(window.MIROZA.builder.build(p))),u.index+=h.length,u.index<u.items.length}u.index===0&&m();const g=Math.ceil(u.index/u.pageSize)||1;return s(g),{renderNext:m,state:u}}function r(e,o){const c=window.MIROZA.utils.qs(e);if(!c||!o||(c.innerHTML="",o.state.index>=o.state.items.length))return;const d=document.createElement("button");d.className="load-more",d.textContent="Load more",d.addEventListener("click",()=>{const w=o.renderNext(),f=Math.ceil(o.state.index/o.state.pageSize)||1;s(f),w||d.remove()}),c.appendChild(d)}function l(){const e="#articles-list",o="#articles-pagination";if(!window.MIROZA.store||!window.MIROZA.utils.qs(e))return;const c=window.MIROZA.store.getAll();if(!c||!c.length){window.MIROZA.utils.qs(e).innerHTML="<p>No articles found.</p>";return}const d=n();let w=c.filter(u=>u.category!=="Blog").slice().sort((u,m)=>(m.date||"").localeCompare(u.date||""));d&&(w=w.filter(u=>(u.category||"").toLowerCase()===d.toLowerCase()||(u.title||"").toLowerCase().includes(d.toLowerCase())));const f=t(e,w,12);r(o,f)}async function a(){const e="#posts-grid";let o="#blogs-pagination";if(window.MIROZA.utils.qs(e)){if(!window.MIROZA.utils.qs(o)){const c=document.createElement("nav");c.id="blogs-pagination",c.className="pagination",window.MIROZA.utils.qs(e).parentNode.appendChild(c)}try{const c=await fetch("/data/blogs.json");let d=[];c.ok?d=await c.json():(await window.MIROZA.store.init(),d=window.MIROZA.store.getAll().filter(g=>g.category==="Blog"));let w=d.slice().sort((g,h)=>(h.date||"").localeCompare(g.date||"")).map(g=>({title:g.title,slug:g.slug,date:g.date,category:"Blog",excerpt:g.excerpt,link:g.url||g.contentFile||`/blogs/${g.slug}.html`,image:g.image?{src:g.image,alt:g.title}:null}));const f=n();f&&(w=w.filter(g=>(g.title||"").toLowerCase().includes(f.toLowerCase())));const u=t(e,w,12);r(o,u);const m=document.getElementById("posts-skeleton");m&&(m.style.display="none")}catch(c){console.error("Failed to load blogs",c)}}}return{initArticles:l,initBlogs:a}}(),window.MIROZA.postMeta=function(){function i(){var u,m,g,h,p,b,I;const n=document.body.dataset.page||"";if(!/article|news-article|blog-article/.test(n)||document.querySelector('script[type="application/ld+json"]'))return;const s=((u=document.querySelector('meta[property="og:title"]'))==null?void 0:u.getAttribute("content"))||document.title,t=((m=document.querySelector('meta[name="description"]'))==null?void 0:m.getAttribute("content"))||((g=document.querySelector('meta[property="og:description"]'))==null?void 0:g.getAttribute("content"))||"",r=((h=document.querySelector('meta[property="og:image"]'))==null?void 0:h.getAttribute("content"))||((p=document.querySelector("img"))==null?void 0:p.src)||"",l=((b=document.querySelector('link[rel="canonical"]'))==null?void 0:b.href)||window.location.href,a=document.querySelector(".single-article time")||document.querySelector(".meta time"),e=a?a.getAttribute("datetime")||a.textContent:((I=document.querySelector('meta[property="article:published_time"]'))==null?void 0:I.getAttribute("content"))||"",o=document.querySelector(".author")||document.querySelector('meta[name="author"]'),c=o?o.textContent||o.getAttribute("content"):"",w={"@context":"https://schema.org","@type":n==="blog-article"||n==="blog"?"BlogPosting":"NewsArticle",headline:s,description:t,image:r,datePublished:e||void 0,author:c?{"@type":"Person",name:c}:void 0,publisher:{"@type":"Organization",name:"MIROZA",logo:{"@type":"ImageObject",url:location.origin+"/assets/icons/logo.svg"}},mainEntityOfPage:{"@type":"WebPage","@id":l}};Object.keys(w).forEach(y=>w[y]===void 0&&delete w[y]);const f=document.createElement("script");f.type="application/ld+json",f.text=JSON.stringify(w,null,2),document.head.appendChild(f)}return{init:i}}(),window.MIROZA.ads=function(){function i(){const n=window.MIROZA.utils.qsa(".ad-slot");n.length&&n.forEach(s=>{s.dataset.loaded||(s.dataset.loaded="true")})}return{init:i}}(),document.addEventListener("DOMContentLoaded",()=>{window.MIROZA.theme.init(),window.MIROZA.nav.init(),window.MIROZA.ui.init(),window.MIROZA.subscription.init(),window.MIROZA.ads.init();const i=window.MIROZA.utils.qs(".theme-toggle");i&&i.addEventListener("click",window.MIROZA.theme.toggle);const n=document.body.dataset.page||"home",s=n==="home",t=n==="india-news",r=n==="articles",l=n==="blog";window.MIROZA.store&&typeof window.MIROZA.store.init=="function"?window.MIROZA.store.init().then(()=>{s&&window.MIROZA.home&&window.MIROZA.home.init(),r&&window.MIROZA.listing&&window.MIROZA.listing.initArticles(),l&&window.MIROZA.listing&&window.MIROZA.listing.initBlogs(),window.MIROZA.search&&window.MIROZA.search.init(),t&&window.MIROZA.indiaNews&&window.MIROZA.indiaNews.init(),window.MIROZA.postMeta&&window.MIROZA.postMeta.init(),document.body.classList.add("js-ready")}).catch(()=>{t&&window.MIROZA.indiaNews&&window.MIROZA.indiaNews.init(),window.MIROZA.postMeta&&window.MIROZA.postMeta.init(),document.body.classList.add("js-ready")}):(t&&window.MIROZA.indiaNews&&window.MIROZA.indiaNews.init(),l&&window.MIROZA.listing&&window.MIROZA.listing.initBlogs(),window.MIROZA.postMeta&&window.MIROZA.postMeta.init(),document.body.classList.add("js-ready"));try{const a=(location.pathname||"").toLowerCase(),e=a.includes("/articles/")&&!/articles(\/|index\.html|articles\.html)$/.test(a),o=a.includes("/blogs/")&&!/blogs(\/|index\.html|blogs\.html)$/.test(a);if(e||o){const c=document.createElement("script");c.src="/scripts/article-nav.js",c.defer=!0,document.body.appendChild(c)}}catch(a){}}),window.MIROZA.loadPosts=async()=>(await window.MIROZA.store.init(),window.MIROZA.store.getAll()),window.MIROZA.buildCard=window.MIROZA.builder.build})();

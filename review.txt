MIROZA Repair Summary
=====================

Date: 2025-11-29

Summary of changes made (this run):

- Unified theme storage key: updated `scripts/app.js` to use `localStorage['theme']` instead of `miroza_theme` so the theme toggle behaves consistently across `site-shell.js`, `theme.js`, and `app.js`.
- Added a migration in `scripts/theme.js` to copy any legacy `miroza_theme` value into the new `theme` key to avoid breaking older pages.
- Created three placeholder article pages to resolve missing feed links referenced in `data/posts.json` that produced 404s: 
  - `/articles/newsletter-strategy-engagement.html`
  - `/articles/security-headers-practical-defaults.html`
  - `/articles/robust-offline-experiences.html`
  These placeholders include the site shell and scripts; replace with full content when available.
- Added a small link-checker script at `tools/check-links.js` and executed it to verify `data/posts.json` references resolve to files on disk.

Files added or modified in this session:

Modified:
- `scripts/app.js`  — changed theme storage key to `'theme'`.
- `scripts/theme.js` — added migration code for legacy `miroza_theme`.

Added:
- `articles/newsletter-strategy-engagement.html` (placeholder)
- `articles/security-headers-practical-defaults.html` (placeholder)
- `articles/robust-offline-experiences.html` (placeholder)
- `tools/check-links.js` (link verification helper)

What I validated during the run:

- `data/posts.json` was inspected and initially referenced three article files that did not exist — placeholders were created and the link checker now reports all links resolve.
- Core script files exist: `scripts/app.js`, `scripts/theme.js`, `scripts/site-shell.js`, `scripts/news-list.js`, `scripts/data-loader.js`, `scripts/main.js`.
- Styles are present: `styles/styles.min.css`, `styles/theme.css`, and `styles/global.css`.
- Key pages present: `/index.html`, `/news/news.html`, `/articles.html`, `/blogs/blogs.html`, `/about.html`, `/contact.html` and per-item pages under `/articles/` and `/news/`.

Remaining recommended work (optional but advised):

1. Replace the placeholder article pages with real content (copy from source or markdown renderer) where available.
2. Consider a full repo-wide replacement of legacy theme references (instances of `miroza_theme`) to `theme` to simplify code (migration is already present so it is not urgent).
3. Run a live smoke test in a browser (or headless Chromium) to confirm runtime JS (fetch calls) work and there are no console errors when loading `/index.html`, `/news/news.html`, a sample `/news/*` article, `/articles.html` and `/blogs/blogs.html`.
4. Optionally run an HTML validator / link-check across all pages (tools/check-links.js only checks `data/posts.json` links currently).
5. Review and consolidate duplicate theme/navigation code across `site-shell.js`, `theme.js`, and the inline scripts embedded in legacy pages (move to a single source to reduce duplication).

If you want, I can now:


Smoke test (automated)
----------------------

- I added `tools/static-server.js` and `tools/smoke-test.js` and used them to run a Puppeteer smoke test that visits key pages (`/`, `/index.html`, `/news/news.html`, a sample news article, `/articles/articles.html`, a sample article, and `/blogs/blogs.html`).
- I removed inline theme snippet blocks (which were blocked by the site's CSP) from many HTML files using `tools/remove-inline-theme.js` and re-ran the smoke test.
- Result: All visited pages returned HTTP 200 and the test recorded cards loaded for the index and listing pages. The smoke-test wrote `REVIEW_SMOKE.json` with details and reported 0 errors on the final run.

Files added in this session (summary):
- `tools/static-server.js` (simple static server for smoke-tests)
- `tools/smoke-test.js` (Puppeteer smoke-test; spawns the server, runs checks, writes `REVIEW_SMOKE.json`)
- `tools/remove-inline-theme.js` (utility to remove inline theme snippets blocked by CSP)

Files modified in this session (high level):
- `scripts/app.js` (unified theme storage key -> `'theme'`)
- `scripts/theme.js` (added migration from legacy `miroza_theme` to `theme`)
- `scripts/theme.js` / `scripts/site-shell.js` already present and used for unified theme handling
- Many HTML files had inline theme snippets removed (approx 97 files changed) to avoid CSP blocking and rely on external scripts; this includes files under `articles/`, `blogs/`, `news/`, and root-level pages.
- Added placeholder article pages: `articles/newsletter-strategy-engagement.html`, `articles/security-headers-practical-defaults.html`, `articles/robust-offline-experiences.html` to avoid 404s for feed-referenced links.

Where to go next
-----------------
- Replace placeholders with full article content when available.
- Optionally perform a repo-wide conversion of any remaining references to `miroza_theme` → `theme` (migration code is present but a static sweep would simplify the codebase).
- Run further tests (link-checker, visual regression, Lighthouse) if you want more validation.

REVIEW SUMMARY

1. scripts/app.js
   - Added `MIROZA.store` module (fetches /data/posts.json).
   - Added `MIROZA.builder` module (generates HTML cards).
   - Added `MIROZA.subscription` module (handles form submit + CSV export).
   - Refined `MIROZA.home.init` to use the new store.

2. index.html
   - Switched to `styles.min.css` and `app.min.js`.
   - Added `rel="noopener noreferrer"` to footer links.
   - Confirmed SEO meta tags are present.

3. Assets
   - Generated `styles/styles.min.css`
   - Generated `scripts/app.min.js`
   - Created `sitemap.xml`

4. New Features
   - Subscription data is saved to Browser LocalStorage.
   - Admin Export: Double-click "Stay Updated" in footer to download CSV.

   Additional update (2025-11-29):
   - `scripts/app.min.js` was edited in-place to replace the legacy `miroza_theme` storage key with `theme` so the minified bundle and unminified runtime are consistent. This avoids a mismatch between runtime and production artifacts; a full rebuild is still recommended when convenient.

